{"version":3,"file":"usermanager.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../sources/views/_hidden.js","../sources/views/addmenu.js","../sources/views/sidebar.js","../sources/views/compact/sidemenu.js","../sources/helpers/infolist.js","../sources/helpers/templates.js","../sources/views/roles/details.js","../sources/views/roles/editor.js","../sources/helpers/palette.js","../sources/views/roles/form.js","../sources/views/sections/view.js","../sources/views/roles/grid.js","../sources/views/sections/toolbar.js","../sources/views/roles/toolbar.js","../sources/views/roles/index.js","../sources/helpers/icons.js","../sources/views/roles/matrix.js","../sources/views/roles/members.js","../sources/helpers/customcheckbox.js","../sources/views/roles/rules.js","../sources/views/rules/details.js","../sources/views/rules/index.js","../sources/views/topbar.js","../sources/helpers/responsive.js","../sources/views/top.js","../sources/helpers/dateFormat.js","../sources/views/users/audit.js","../sources/views/users/credentials.js","../sources/views/users/details.js","../sources/views/users/editor.js","../sources/views/users/form.js","../sources/views/users/grid.js","../sources/views/users/toolbar.js","../sources/views/users/index.js","../sources/views/users/matrix.js","../sources/views/users/roles.js","../sources/views/users/rulematrix.js","../sources/views/users/rules.js","../sources/helpers/roleslist.js","../sources/export_views.js","../sources/models/Backend.js","../sources/models/Local.js","../sources/models/Operations.js","../sources/models/Progress.js","../sources/models/Prompt.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over)\r\n            ui = over.get(ui) || ui;\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tvar key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\t// normal js object\n\tfor (const key2 in data) {\n\t\tif (data.hasOwnProperty(key2)) {\n\t\t\tconst test = data[key2];\n\t\t\tif (config.nested && typeof test === \"object\" && test) {\n\t\t\t\tout[key2] = createState(test, config);\n\t\t\t} else {\n\t\t\t\treactive(out, test, key2, notify);\n\t\t\t}\n\t\t}\n\t}\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","import { JetView } from \"webix-jet\";\n\nexport default class HiddenView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\thidden: true,\n\t\t};\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class AddNewMenuView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.WithRoles = this.app.config.roles;\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\tid: \"user\",\n\t\t\t\tvalue: _(\"Add new user\"),\n\t\t\t},\n\t\t];\n\n\t\tif (this.WithRoles)\n\t\t\tmenuItems.push({\n\t\t\t\tid: \"role\",\n\t\t\t\tvalue: _(\"Add new role\"),\n\t\t\t});\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\twidth: 176,\n\t\t\tpadding: 0,\n\t\t\tpoint: 0,\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_um_add_new_menu\",\n\t\t\tbody: {\n\t\t\t\tview: \"menu\",\n\t\t\t\tautoheight: true,\n\t\t\t\tlayout: \"y\",\n\t\t\t\tdata: menuItems,\n\t\t\t\ton: {\n\t\t\t\t\tonMenuItemClick: id => {\n\t\t\t\t\t\tthis.AddNew(id);\n\t\t\t\t\t\tthis.getRoot().hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tAddNew(id) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst prompt = this.app.getService(\"prompt\");\n\t\tif (id == \"role\") {\n\t\t\tprompt\n\t\t\t\t.show(_(\"Enter role name\"))\n\t\t\t\t.then(name => this.app.getService(\"operations\").addRole({ name }))\n\t\t\t\t.then(data => this.ShowDetails(\"roles\", data.id));\n\t\t} else if (id == \"user\") {\n\t\t\tprompt\n\t\t\t\t.show(_(\"Enter user name\"))\n\t\t\t\t.then(name => {\n\t\t\t\t\treturn this.app.getService(\"operations\").addUser({ name });\n\t\t\t\t})\n\t\t\t\t.then(data => this.ShowDetails(\"users\", data.id));\n\t\t}\n\t}\n\tShowDetails(collection, id) {\n\t\tthis.app.callEvent(\"details:item-click\", [collection, id]);\n\t}\n\tShow(target) {\n\t\tthis.getRoot().show(target, { x: 2 });\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport AddNewMenu from \"views/addmenu\";\n\nexport default class SideBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.WithRoles = this.app.config.roles;\n\n\t\tconst newButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"add-button\",\n\t\t\tcss: \"webix_primary\",\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"wxi-plus\",\n\t\t\tlabel: _(\"New\"),\n\t\t\tclick: function() {\n\t\t\t\tthis.$scope.Menu.Show(this.$view);\n\t\t\t},\n\t\t};\n\n\t\tlet menuItems = [\n\t\t\t{ id: \"users\", value: _(\"Users\"), icon: \"umi-users\" },\n\t\t\t{ id: \"roles\", value: _(\"Roles\"), icon: \"umi-roles\" },\n\t\t\t{ id: \"rules\", value: _(\"Rules\"), icon: \"umi-rules\" },\n\t\t];\n\t\tif (!this.WithRoles) menuItems.splice(1, 1);\n\n\t\tconst bar = {\n\t\t\tselect: true,\n\t\t\twidth: 210,\n\t\t\tview: \"list\",\n\t\t\tcss: \"webix_um_sidebar_menu\",\n\t\t\tlocalId: \"menu\",\n\t\t\tclick: id => this.ShowPage(id),\n\t\t\ttype: {\n\t\t\t\theight: webix.skin.$active.listItemHeight + 8,\n\t\t\t},\n\t\t\tdata: menuItems,\n\t\t\ttemplate: \"<span class='webix_icon #icon#'></span>#value#\",\n\t\t};\n\n\t\treturn {\n\t\t\tcss: \"webix_um_sidebar\",\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tpaddingX: 15,\n\t\t\t\t\tpaddingY: 15,\n\t\t\t\t\ttype: \"form\",\n\t\t\t\t\trows: [newButton],\n\t\t\t\t},\n\t\t\t\tbar,\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Menu = this.ui(AddNewMenu);\n\t\tthis.on(this.app, \"onAddButtonClick\", target => this.Menu.Show(target));\n\t}\n\n\turlChange() {\n\t\tconst page = this.getUrl()[1].page;\n\t\tconst mode = page.split(\".\")[0];\n\t\tthis.$$(\"menu\").select(mode);\n\t}\n\n\tShowPage(id) {\n\t\tthis.show(\"./\" + id);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nimport SideBar from \"../sidebar\";\n\nexport default class SideMenu extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"sidemenu\",\n\t\t\twidth: 300,\n\t\t\tposition: \"left\",\n\t\t\tstate: state => {\n\t\t\t\tstate.left = this.Parent.left;\n\t\t\t\tstate.top = this.Parent.top;\n\t\t\t\tstate.height = this.Parent.height;\n\t\t\t},\n\t\t\tbody: SideBar,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.on(this.app, \"top:navigation\", () => {\n\t\t\tthis.getRoot().hide();\n\t\t});\n\t}\n\tShow(box) {\n\t\tif (this.getRoot().isVisible()) return;\n\n\t\tthis.Parent = box;\n\t\tthis.webix.delay(() => this.getRoot().show());\n\t}\n}\n","export function getInfoList(lists) {\n\tlet result = \"\";\n\tlists.forEach(config => {\n\t\tresult += \"<div class='webix_um_infolist_header'>\";\n\t\tif (config.icon)\n\t\t\tresult += `<span class='webix_icon ${config.icon}'></span>`;\n\t\tresult += `${config.title} (${config.data.length})</div>`;\n\t\tresult += \"<ul class='webix_um_infolist'>\";\n\t\tconfig.data.forEach(record => {\n\t\t\tresult += `<li class='webix_um_infolist_${config.name}_item' data-id='${record.id}'>`;\n\t\t\tresult += `<span class='webix_um_infolist_name webix_um_infolist_${\n\t\t\t\tconfig.name\n\t\t\t}_name'>${record[config.key]}</span>`;\n\t\t\tif (config.deleteIcon)\n\t\t\t\tresult += `<span class='webix_um_infolist_${config.name}_delete webix_icon wxi-close'></span>`;\n\t\t\tresult += \"</li>\";\n\t\t});\n\t\tresult += \"</ul>\";\n\t});\n\treturn result;\n}\n","/* adds a mark for text occurrence in a value */\nfunction addTextMark(value, text) {\n\treturn value.replace(\n\t\tnew RegExp(\"(\" + text + \")\", \"ig\"),\n\t\t\"<span class='webix_um_search_mark'>$1</span>\"\n\t);\n}\n\nexport function text(view) {\n\treturn function(data, type, value) {\n\t\tlet search = view.EscapedSearchText;\n\t\tif (search) {\n\t\t\tvalue = addTextMark(value, search);\n\t\t}\n\t\treturn value;\n\t};\n}\n\nexport function rule(view) {\n\treturn function(data) {\n\t\tlet search = view.EscapedSearchText;\n\t\tlet short = data.short;\n\t\tlet long = data.long;\n\t\tif (search) {\n\t\t\tshort = addTextMark(short, search);\n\t\t\tlong = addTextMark(long, search);\n\t\t}\n\t\treturn short + `<div class='webix_um_details_row'>${long}</div>`;\n\t};\n}\n\nexport function statusBadge(value, _) {\n\tlet status = value ? \"Active\" : \"Not active\";\n\tlet cssStatusName = value ? \"active\" : \"not_active\";\n\n\tlet html = `\n\t\t<div class=\"webix_um_badge_container\">\n\t\t\t<span class=\"webix_um_status_badge webix_um_${cssStatusName}\">${_(\n\t\tstatus\n\t)}</span>\n\t\t</div>`;\n\treturn html;\n}\n\nexport function roleAvatar(role, cssClass) {\n\tlet css = typeof cssClass == \"string\" ? cssClass : \"webix_um_role_avatar\";\n\treturn `<div class='${css}' style='background-color: ${\n\t\trole.color ? role.color : \"\"\n\t}'>${role.name ? role.name.charAt(0).toUpperCase() : \"\"}</div>`;\n}\n\nfunction userCss(name) {\n\treturn \" webix_um_avatar_\" + ((name.charCodeAt(1) + (name.length % 10)) % 10);\n}\n\nexport function userAvatar(user, cssClass) {\n\tlet css = typeof cssClass == \"string\" ? cssClass : \"webix_um_member_avatar\";\n\tif (user.avatar) return `<img class=\"${css}\" src=\"${user.avatar}\"/>`;\n\treturn `<div class='${css} ${\n\t\tuser.name ? userCss(user.name) : \"webix_um_no_name\"\n\t}'>${user.name ? user.name.charAt(0).toUpperCase() : \"\"}</div>`;\n}\n","import { JetView } from \"webix-jet\";\nimport { getInfoList } from \"../../helpers/infolist\";\nimport { roleAvatar } from \"../../helpers/templates\";\n\nexport default class UsersView extends JetView {\n\tconfig() {\n\t\tconst padding = { left: 10 };\n\t\tconst headers = {\n\t\t\tview: \"toolbar\",\n\n\t\t\tpadding,\n\t\t\tcols: [\n\t\t\t\t{ view: \"label\", label: \"Role information\" },\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\t\tclick: () => this.Edit(this.ID),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst details = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"title\",\n\t\t\tautoheight: true,\n\t\t\ttemplate: this.TitleTemplate,\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"info\",\n\t\t\ttemplate: \" \",\n\t\t\tscroll: true,\n\t\t\tonClick: {\n\t\t\t\twebix_um_infolist_users_name: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"users\", id]);\n\t\t\t\t},\n\t\t\t\twebix_um_infolist_rules_name: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"rules\", id]);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tlocalId: \"layout\",\n\t\t\tmaxWidth: 350,\n\t\t\trows: [\n\t\t\t\theaders,\n\t\t\t\t{\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [details, info],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tif (!this.Compact) this.SetValues();\n\t}\n\n\tSetValues() {\n\t\tthis.ID = this.getParam(\"id\", true);\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst roles = local.roles(true);\n\t\troles.waitData.then(() => {\n\t\t\tconst role = roles.getItem(this.ID);\n\t\t\t// called outside Promise.all to display role title faster\n\t\t\tthis.SetTitle(role);\n\t\t\tPromise.all([local.rules(), local.users()]).then(data => {\n\t\t\t\tthis.SetDetails(role, data[0], data[1]);\n\t\t\t});\n\t\t});\n\t}\n\tSetTitle(role) {\n\t\tthis.$$(\"title\").setValues({ color: role.color, name: role.name });\n\t}\n\tTitleTemplate(role) {\n\t\treturn (\n\t\t\troleAvatar(role, \"webix_um_avatarbox_roles\") +\n\t\t\t`<div class='webix_um_title'>${role.name ? role.name : \"\"}</div>`\n\t\t);\n\t}\n\n\tSetDetails(role, allRules, allUsers) {\n\t\tthis.$$(\"info\").setHTML(this.GetDetailsHTML(role, allRules, allUsers));\n\t}\n\n\tGetDetailsHTML(role, allRules, allUsers) {\n\t\treturn this.GetListsHTML(role, allRules, allUsers);\n\t}\n\tGetListsHTML(role, allRules, allUsers) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tlet assigned = this.GetAssignments(role, allRules, allUsers);\n\t\treturn getInfoList([\n\t\t\t{\n\t\t\t\tname: \"rules\",\n\t\t\t\tdata: assigned.rules,\n\t\t\t\tkey: \"long\",\n\t\t\t\ttitle: _(\"Rules assigned\"),\n\t\t\t\ticon: \"umi-rules\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: \"users\",\n\t\t\t\tdata: assigned.users,\n\t\t\t\tkey: \"name\",\n\t\t\t\ttitle: _(\"Members assigned\"),\n\t\t\t\ticon: \"umi-users\",\n\t\t\t},\n\t\t]);\n\t}\n\n\tGetAssignments(role, allRules, allUsers) {\n\t\tlet assigned = {};\n\t\tassigned.rules = this.GetRoleRules(role, allRules);\n\t\tassigned.users = this.GetRoleMembers(role, allUsers);\n\t\treturn assigned;\n\t}\n\n\tGetRoleRules(role, rules) {\n\t\tconst rIds = role.rules || [];\n\t\tlet data = [];\n\t\trIds.forEach(id => {\n\t\t\tdata.push(rules.getItem(id));\n\t\t});\n\t\treturn data;\n\t}\n\n\tGetRoleMembers(role, users) {\n\t\tlet roleUsers = [];\n\t\tusers.data.each(user => {\n\t\t\tif (user.roles && user.roles.indexOf(role.id) > -1) roleUsers.push(user);\n\t\t});\n\t\treturn roleUsers;\n\t}\n\n\tEdit(id) {\n\t\tthis.show(`../../roles?id=${id}/roles.editor`);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EditorView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst tabbar = {\n\t\t\tview: \"tabbar\",\n\t\t\tlocalId: \"tabbar\",\n\t\t\ttabMinWidth: 80,\n\t\t\tcss: \"webix_um_editor_tabbar\",\n\t\t\theight: webix.skin.$active.barHeight - 2,\n\t\t\ttype: \"bottom\",\n\t\t\tborderless: true,\n\t\t\toptions: [\n\t\t\t\t{ id: \"roles.form\", value: _(\"General\") },\n\t\t\t\t{ id: \"roles.rules\", value: _(\"Rules\") },\n\t\t\t\t{ id: \"roles.members\", value: _(\"Members\") },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: v => this.SetMode(v),\n\t\t\t},\n\t\t};\n\t\tconst toolbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding: {\n\t\t\t\tleft: 2,\n\t\t\t\tright: 0,\n\t\t\t\ttop: 0,\n\t\t\t\tbottom: 0,\n\t\t\t},\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"umi-back\",\n\t\t\t\t\tclick: () =>\n\t\t\t\t\t\tthis.app.callEvent(\"details.back:click\", [\n\t\t\t\t\t\t\t\"roles\",\n\t\t\t\t\t\t\tthis.getParam(\"id\", true),\n\t\t\t\t\t\t]),\n\t\t\t\t},\n\t\t\t\ttabbar,\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\trows: [toolbar, { $subview: true }],\n\t\t};\n\t}\n\n\tinit() {\n\t\tif (this.getUrl().length < 2) this.show(\"./roles.form\");\n\t\telse this.$$(\"tabbar\").setValue(this.getUrl()[1].page);\n\t}\n\n\tSetMode(v) {\n\t\tthis.show(v);\n\t}\n}\n","export default [\n\t[\n\t\t\"#00a037\",\n\t\t\"#13a1aa\",\n\t\t\"#df282f\",\n\t\t\"#fd772c\",\n\t\t\"#6d4bce\",\n\t\t\"#b26bd3\",\n\t\t\"#c87095\",\n\t\t\"#90564d\",\n\t],\n\t[\n\t\t\"#eb2f89\",\n\t\t\"#ea77c0\",\n\t\t\"#777676\",\n\t\t\"#a9a8a8\",\n\t\t\"#9bb402\",\n\t\t\"#e7a90b\",\n\t\t\"#0bbed7\",\n\t\t\"#038cd9\",\n\t],\n];\n","import { JetView } from \"webix-jet\";\nimport palette from \"helpers/palette\";\n\nexport default class UsersView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tscroll: \"auto\",\n\t\t\tmargin: 20,\n\t\t\tcss: \"webix_um_edit_form\",\n\t\t\telementsConfig: {\n\t\t\t\tlabelWidth: 130,\n\t\t\t\tlabelAlign: \"right\",\n\t\t\t},\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tmargin: 10,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\twidth: 120,\n\t\t\t\t\t\t\tlabel: _(\"Delete\"),\n\t\t\t\t\t\t\tclick: () => this.Delete(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidth: 120,\n\t\t\t\t\t\t\tvalue: _(\"Save\"),\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\t\tclick: () => this.Save(),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"text\",\n\t\t\t\t\tlabel: _(\"Name\"),\n\t\t\t\t\tname: \"name\",\n\t\t\t\t\tlocalId: \"focus\",\n\t\t\t\t\tinputWidth: 370,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\tname: \"color\",\n\t\t\t\t\tinputWidth: 370,\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\tview: \"colorboard\",\n\t\t\t\t\t\t\tpalette,\n\t\t\t\t\t\t\twidth: 8 * 29,\n\t\t\t\t\t\t\theight: 2 * 29,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\twebix.delay(() => this.$$(\"focus\").focus());\n\t\tthis.ID = this.getParam(\"id\", true);\n\t\tif (this.ID) {\n\t\t\tconst data = this.app.getService(\"local\").roles(true);\n\t\t\tdata.waitData.then(() => {\n\t\t\t\tconst role = data.getItem(this.ID);\n\t\t\t\tthis.$$(\"form\").setValues(role);\n\t\t\t});\n\t\t}\n\t}\n\n\tSave() {\n\t\tif (this.ID) {\n\t\t\tlet roleData = this.$$(\"form\").getValues();\n\n\t\t\tthis.app.getService(\"operations\").updateRole(this.ID, roleData);\n\t\t}\n\t}\n\n\tDelete() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete\"),\n\t\t\t\tok: _(\"Delete\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to delete this role ?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.app.getService(\"operations\").deleteRole(this.ID);\n\t\t\t\tthis.app.show(\"/top/roles/_hidden\");\n\t\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class BaseGrid extends JetView {\n\tconfig() {\n\t\tlet table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"table\",\n\t\t\trowHeight: webix.skin.$active.rowHeight,\n\t\t\theaderRowHeight:\n\t\t\t\twebix.skin.$active.barHeight - webix.skin.$active.borderWidth * 2,\n\t\t\tselect: true,\n\t\t\ton: {\n\t\t\t\tonAfterSelect: id => this.ShowDetails(id),\n\t\t\t},\n\t\t\tcolumns: [],\n\t\t};\n\n\t\treturn table;\n\t}\n\n\t/*shows details view*/\n\tShowDetails() {}\n\n\t/* initializes search properties and attaches event listening for search input*/\n\tInitSelf(data, id) {\n\t\t/* loads data and selects first entity in the table */\n\t\tconst table = this.$$(\"table\");\n\t\t(data.waitData || table.waitData).then(() => {\n\t\t\tif (id) this.$$(\"table\").select(id);\n\t\t\tthis.on(this.getParam(\"state\", true).$changes, \"search\", v =>\n\t\t\t\tthis.Find(v)\n\t\t\t);\n\t\t\tthis.Table = table;\n\t\t});\n\n\t\ttable.parse(data);\n\t}\n\n\t// select a new item\n\turlChange() {\n\t\tconst t = this.Table;\n\t\tlet id = this.getParam(\"id\", true);\n\t\tif (t && id && t.select && t.getSelectedId() != id) {\n\t\t\tt.select(id);\n\t\t\tt.showItem(id);\n\t\t}\n\t}\n\n\tEscapeRegExp(text) {\n\t\treturn text.replace(/[[\\]{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n\t}\n\n\t/* filters table by input text and highlights occurrences*/\n\tFind(text) {\n\t\tlet table = this.$$(\"table\");\n\t\tthis.EscapedSearchText = this.EscapeRegExp(text || \"\");\n\n\t\tif (text) {\n\t\t\ttext = text.toLowerCase();\n\t\t\ttable.filter(data => this.SearchCompare(text, data));\n\t\t} else table.filter();\n\t}\n}\n","import BaseGrid from \"../sections/view\";\nimport { text, roleAvatar } from \"../../helpers/templates\";\n\nexport default class GridView extends BaseGrid {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst ui = super.config();\n\t\twebix.extend(\n\t\t\tui,\n\t\t\t{\n\t\t\t\trowHeight: webix.skin.$active.rowHeight + 10,\n\t\t\t\theaderRowHeight: webix.skin.$active.barHeight + 10,\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tui.columns = [\n\t\t\t{\n\t\t\t\tid: \"color\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: 60,\n\t\t\t\tcss: \"webix_um_center_column \",\n\t\t\t\ttemplate: roleAvatar,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"name\",\n\t\t\t\theader: _(\"Name\"),\n\t\t\t\tfillspace: 2,\n\t\t\t\tsort: \"string\",\n\t\t\t\ttemplate: text(this),\n\t\t\t},\n\t\t];\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tconst users = this.app.getService(\"local\").roles(true);\n\t\tthis.InitSelf(users, this.getParam(\"id\", true));\n\t}\n\n\tShowDetails(id) {\n\t\tthis.getParentView().ShowDetails(id);\n\t}\n\n\tSearchCompare(value, role) {\n\t\treturn role.name.toLowerCase().indexOf(value) > -1;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ToolbarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst padding = { left: 10, right: 10 };\n\t\tconst state = this.getParam(\"state\");\n\n\t\tconst defbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding,\n\t\t\tbatch: \"main\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\tlabel: state.name,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-search\",\n\t\t\t\t\tclick: () => this.ShowSearchHeader(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst searchbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding,\n\t\t\tbatch: \"search\",\n\t\t\tcols: [\n\t\t\t\t{ view: \"text\", localId: \"search\", placeholder: _(\"Search\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\tclick: () => this.HideSearchHeader(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\tvisibleBatch: \"main\",\n\t\t\tlocalId: \"header\",\n\t\t\trows: [defbar, searchbar],\n\t\t};\n\t}\n\n\t/* initializes search properties and attaches event listening for search input*/\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.$$(\"search\").attachEvent(\"onTimedKeyPress\", () => {\n\t\t\tthis.State.search = this.$$(\"search\").getValue();\n\t\t});\n\t}\n\n\t/* shows search toolbar */\n\tShowSearchHeader() {\n\t\tthis.$$(\"header\").showBatch(\"search\");\n\t\tthis.$$(\"search\").focus();\n\t}\n\n\t/* hides search toolbar and reset filtering results in a table */\n\tHideSearchHeader() {\n\t\tthis.$$(\"search\").setValue(\"\");\n\t\tthis.$$(\"header\").showBatch(\"main\");\n\t\tthis.State.search = \"\";\n\t}\n}\n","import Toolbar from \"../sections/toolbar\";\n\nexport default class ToolbarView extends Toolbar {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\");\n\t\tconst ui = super.config();\n\n\t\tui.rows[0].cols.push({\n\t\t\tview: \"toggle\",\n\t\t\twidth: 150,\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"umi-matrix\",\n\t\t\tlabel: _(\"Rule Matrix\"),\n\t\t\ton: {\n\t\t\t\tonChange: v => this.ToggleVisible(v, state),\n\t\t\t},\n\t\t});\n\n\t\treturn ui;\n\t}\n\n\tToggleVisible(v, state) {\n\t\tstate.mode = v ? \"matrix\" : \"grid\";\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport Toolbar from \"./toolbar\";\n\nimport { createState } from \"jet-restate\";\n\nexport default class RolesView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tthis.setParam(\n\t\t\t\"state\",\n\t\t\tcreateState({ mode: \"grid\", name: _(\"Roles\"), search: \"\" })\n\t\t);\n\n\t\treturn {\n\t\t\tmargin: 10,\n\t\t\tpadding: 10,\n\t\t\tcss: \"webix_um_tableview\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"list\",\n\t\t\t\t\trows: [\n\t\t\t\t\t\tToolbar,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$subview: true,\n\t\t\t\t\t\t\tname: \"center\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{ $subview: \"_hidden\", name: \"default\" },\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.on(this.getParam(\"state\").$changes, \"mode\", v => {\n\t\t\tthis.show(\"roles.\" + v, { target: \"center\" });\n\t\t\tif (v === \"matrix\") {\n\t\t\t\tthis.setParam(\"id\", null);\n\t\t\t\tthis.show(\"./_hidden\");\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.app, \"roles.back:click\", () => this.HideEditor());\n\t}\n\n\tShowDetails(id) {\n\t\tconst now = this.getParam(\"id\");\n\t\tconst next = id.toString();\n\n\t\tif (this.getParam(\"compact\", true) || !now) {\n\t\t\tthis.app.callEvent(\"details:item-click\", [\"roles\", next]);\n\t\t} else if (now !== next) {\n\t\t\tthis.setParam(\"id\", next, true);\n\t\t}\n\t}\n\n\tToggleVisible(mode) {\n\t\tif (mode) {\n\t\t\tthis.show(\"_hidden\", { target: \"default\" });\n\t\t\tthis.show(\"roles.matrix\", { target: \"center\" });\n\t\t\tthis.$$(\"toolbar\").showBatch(\"matrix\");\n\t\t} else {\n\t\t\tthis.show(\"roles.grid\", { target: \"center\" });\n\t\t\tthis.$$(\"toolbar\").showBatch(\"default\");\n\t\t}\n\t}\n}\n","export const folderIcon = \"<span class='webix_icon wxi-folder'></span>\";\nexport const backIcon =\n\t\"<span class='webix_icon wxi-angle-double-left'></span>\";\nexport const menuIcon = \"<span class='webix_icon wxi-dots'></span>\";\n\nexport const checkedIcon =\n\t\"<span class='webix_icon wxi-checkbox-marked'></span>\";\nexport const notCheckedIcon =\n\t\"<span class='webix_icon wxi-checkbox-blank'></span>\";\n\nexport const checkedIconAlt =\n\t\"<span class='webix_icon wxi-check'></span>\";\nexport const notCheckedIconAlt =\n\t\"<span class='webix_icon wxi-minus '></span>\";\n","// import Templates from \"views/basegrid/templates\";\nimport BaseGrid from \"../sections/view\";\nimport { rule } from \"../../helpers/templates\";\nimport { checkedIconAlt, notCheckedIconAlt } from \"../../helpers/icons\";\n\nexport default class MatrixView extends BaseGrid {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Sorting = { column: \"\", dir: \"\" };\n\n\t\tconst ui = super.config();\n\n\t\twebix.extend(\n\t\t\tui,\n\t\t\t{\n\t\t\t\tcss: \"webix_um_matrix\",\n\t\t\t\theaderRowHeight: 56,\n\t\t\t\trowHeight: 62,\n\t\t\t\trowLineHeight: 29,\n\t\t\t\tleftSplit: 1,\n\t\t\t\tselect: false,\n\t\t\t\ton: {\n\t\t\t\t\tonItemClick: id => this.Toggle(id),\n\t\t\t\t\t// to sort descendant by default\n\t\t\t\t\tonHeaderClick: header => this.ToggleColumnSorting(header.column),\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn this.GetRoleColumns().then(roles => {\n\t\t\tui.columns = [\n\t\t\t\t{\n\t\t\t\t\tid: \"short\",\n\t\t\t\t\theader: _(\"Rules\"),\n\t\t\t\t\twidth: 220,\n\t\t\t\t\tcss: \"webix_um_column_name\",\n\t\t\t\t\tsort: \"string\",\n\t\t\t\t\ttemplate: rule(this),\n\t\t\t\t},\n\t\t\t\t...roles,\n\t\t\t];\n\n\t\t\treturn ui;\n\t\t});\n\t}\n\n\tinit() {\n\t\treturn this.GetData();\n\t}\n\n\tGetData() {\n\t\tconst local = this.app.getService(\"local\");\n\t\treturn Promise.all([local.roles(), local.rules()]).then(res => {\n\t\t\tconst data = this.CreateMatrix(res[0], res[1]);\n\t\t\tthis.InitSelf(data);\n\t\t});\n\t}\n\n\tSearchCompare(value, rule) {\n\t\treturn (\n\t\t\trule.short.toLowerCase().indexOf(value) > -1 ||\n\t\t\trule.long.toLowerCase().indexOf(value) > -1\n\t\t);\n\t}\n\n\tSave(id) {\n\t\tconst roleId = id.column;\n\t\tlet role = this.app\n\t\t\t.getService(\"local\")\n\t\t\t.roles(true)\n\t\t\t.getItem(roleId);\n\n\t\trole.rules = [];\n\t\tthis.$$(\"table\").data.each(row => {\n\t\t\tif (row[roleId]) role.rules.push(row.id);\n\t\t});\n\t\tthis.app.getService(\"operations\").updateRole(roleId, role);\n\t}\n\n\tToggle(id) {\n\t\tlet item = this.$$(\"table\").getItem(id);\n\t\tconst column = id.column;\n\t\tif (column != \"short\") {\n\t\t\titem[column] = !item[column];\n\t\t\titem.selected = !item.selected;\n\t\t\tthis.$$(\"table\").updateItem(id, item);\n\t\t\tthis.Save(id);\n\t\t}\n\t}\n\n\tGetRoleColumns() {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.roles()\n\t\t\t.then(roles => {\n\t\t\t\tconst columns = [];\n\t\t\t\troles.data.each(role => {\n\t\t\t\t\tcolumns.push({\n\t\t\t\t\t\tid: role.id,\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\ttext: `<span>${role.name}</span>`,\n\t\t\t\t\t\t\tcss: \"webix_um_center_column webix_um_names\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tminWidth: 100,\n\t\t\t\t\t\tfillspace: 1,\n\t\t\t\t\t\tcss: \"webix_um_center_column\",\n\t\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\t\treturn obj[role.id] ? checkedIconAlt : notCheckedIconAlt;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn columns;\n\t\t\t});\n\t}\n\n\tCreateMatrix(roles, rules) {\n\t\tconst data = rules.serialize().map(({ id, short, long }) => {\n\t\t\tlet roleAssigned = {};\n\t\t\troles.data.each(role => {\n\t\t\t\troleAssigned[role.id] = role.rules\n\t\t\t\t\t? role.rules.indexOf(id) > -1\n\t\t\t\t\t: false;\n\t\t\t});\n\t\t\treturn { id, short, long, ...roleAssigned };\n\t\t});\n\t\treturn data;\n\t}\n\n\tToggleColumnSorting(column) {\n\t\tif (column != \"short\") {\n\t\t\tlet dir =\n\t\t\t\tthis.Sorting.column == column && this.Sorting.dir == \"desc\"\n\t\t\t\t\t? \"asc\"\n\t\t\t\t\t: \"desc\";\n\t\t\tthis.$$(\"table\").sort({ by: column, dir: dir, as: \"string\" });\n\t\t\tthis.$$(\"table\").markSorting(column, dir);\n\t\t\tthis.Sorting.dir = dir;\n\t\t}\n\t\tthis.Sorting.column = column;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { checkedIcon, notCheckedIcon } from \"../../helpers/icons\";\nimport { userAvatar } from \"../../helpers/templates\";\n\nexport default class UsersView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\tlocalId: \"title\",\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\theight: 25,\n\t\t\t\t\t\t\tcss: \"webix_um_details_title\",\n\t\t\t\t\t\t\ttemplate: \"#name#\",\n\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\t\t\tlocalId: \"number\",\n\t\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\t\theight: 40,\n\t\t\t\t\t\t\t\t\tcss: \"webix_um_details_title_description\",\n\t\t\t\t\t\t\t\t\ttemplate: v => {\n\t\t\t\t\t\t\t\t\t\tconst number = v.number ? v.number : 0;\n\t\t\t\t\t\t\t\t\t\tlet descr = !number\n\t\t\t\t\t\t\t\t\t\t\t? _(\"No members\")\n\t\t\t\t\t\t\t\t\t\t\t: `${_(\"Members assigned\")} (${number})`;\n\t\t\t\t\t\t\t\t\t\treturn `<div class=\"webix_um_details_title_description\">${descr}</div>`;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trows: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\t\t\t\t\tlocalId: \"toggle\",\n\t\t\t\t\t\t\t\t\t\t\toffLabel: _(\"Modify\"),\n\t\t\t\t\t\t\t\t\t\t\tonLabel: _(\"Done\"),\n\t\t\t\t\t\t\t\t\t\t\twidth: 160,\n\t\t\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\t\t\tonChange: v => this.ToggleVisible(v),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"users\",\n\t\t\tcss: \"webix_um_details_table\",\n\t\t\trowHeight: webix.skin.$active.rowHeight + 10,\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"selected\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\theader: \"\",\n\t\t\t\t\twidth: 45,\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn obj.selected ? checkedIcon : notCheckedIcon;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"name\",\n\t\t\t\t\theader: {\n\t\t\t\t\t\tcontent: \"textFilter\",\n\t\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => userAvatar(obj) + obj.name,\n\t\t\t\t\tfillspace: 2,\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t},\n\t\t\t],\n\t\t\tcheckboxRefresh: true,\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.Toggle(id.row * 1),\n\t\t\t},\n\t\t};\n\n\t\treturn { type: \"clean\", rows: [form, table] };\n\t}\n\n\turlChange() {\n\t\tthis.ID = this.getParam(\"id\", true) * 1;\n\t\tif (this.ID) this.GetData();\n\t}\n\n\tGetData() {\n\t\tconst local = this.app.getService(\"local\");\n\t\tthis.ShowAll = false;\n\t\tthis.$$(\"users\").registerFilter(\n\t\t\tthis.$$(\"toggle\"),\n\t\t\t{\n\t\t\t\tcompare(_v1, _v2, obj) {\n\t\t\t\t\treturn obj.selected;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tgetValue: a => (a.getValue() ? \"\" : true),\n\t\t\t}\n\t\t);\n\n\t\treturn Promise.all([local.roles(), local.users()]).then(data => {\n\t\t\tthis.Role = webix.copy(data[0].getItem(this.ID));\n\t\t\tthis.Role.number = 0;\n\t\t\tconst users = data[1].serialize().map(({ id, avatar, name, roles }) => {\n\t\t\t\tlet selected = roles && roles.indexOf(this.ID) !== -1;\n\t\t\t\tif (selected) this.Role.number++;\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\tavatar,\n\t\t\t\t\tname,\n\t\t\t\t\tselected,\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis.$$(\"users\").parse(users);\n\t\t\tthis.$$(\"title\").setValues(this.Role);\n\t\t\tthis.ShowNumber();\n\t\t\tthis.Filter();\n\t\t});\n\t}\n\n\tShowNumber() {\n\t\tthis.$$(\"number\").setValues(this.Role);\n\t}\n\n\tSave(id) {\n\t\tconst data = this.app.getService(\"local\").users(true);\n\t\tlet user = data.getItem(id);\n\t\tif (this.$$(\"users\").getItem(id).selected) {\n\t\t\tthis.Role.number++;\n\t\t\tif (!user.roles) user.roles = [];\n\t\t\tif (user.roles.indexOf(this.ID) < 0)\n\t\t\t\tuser.roles[user.roles.length] = this.ID;\n\t\t} else if (user.roles && user.roles.indexOf(this.ID) >= 0) {\n\t\t\tuser.roles.splice(user.roles.indexOf(this.ID), 1);\n\t\t\tthis.Role.number--;\n\t\t}\n\t\tthis.ShowNumber();\n\t\tthis.app.getService(\"operations\").updateUser(id, user);\n\t}\n\n\tToggleVisible() {\n\t\tthis.ShowAll = !this.ShowAll;\n\t\tif (this.ShowAll) this.$$(\"users\").showColumn(\"selected\");\n\t\telse this.$$(\"users\").hideColumn(\"selected\");\n\n\t\tthis.Filter();\n\t}\n\n\tToggle(id) {\n\t\tif (!this.ShowAll) return;\n\t\tconst item = this.$$(\"users\").getItem(id);\n\t\tthis.$$(\"users\").updateItem(id, { selected: !item.selected });\n\t\tthis.Save(id);\n\t}\n\n\tFilter() {\n\t\tthis.$$(\"users\").filterByAll();\n\t\tthis.$$(\"users\").sort((a, b) =>\n\t\t\ta.selected == b.selected\n\t\t\t\t? a.name > b.name\n\t\t\t\t\t? 1\n\t\t\t\t\t: -1\n\t\t\t\t: a.selected\n\t\t\t\t? -1\n\t\t\t\t: 1\n\t\t);\n\t}\n}\n","import { checkedIcon, notCheckedIcon } from \"./icons\";\n\nwebix.ui.datafilter.umMasterCheckox = webix.extend(\n\t{\n\t\trefresh: function(master, node, config) {\n\t\t\tnode.onclick = function() {\n\t\t\t\tconfig.checked = !config.checked;\n\t\t\t\tlet elem = node.querySelector(\".webix_icon\");\n\t\t\t\telem.className =\n\t\t\t\t\t\"webix_icon wxi-checkbox-\" + (config.checked ? \"marked\" : \"blank\");\n\t\t\t\tmaster.data.each(obj => (obj[config.columnId] = config.checked));\n\t\t\t\tmaster.refresh();\n\t\t\t\tmaster.callEvent(\"onCustomSave\", []);\n\t\t\t};\n\t\t},\n\t\trender: function(master, config) {\n\t\t\treturn config.checked ? checkedIcon : notCheckedIcon;\n\t\t},\n\t},\n\twebix.ui.datafilter.masterCheckbox\n);\n","import { JetView } from \"webix-jet\";\n\nimport \"../../helpers/customcheckbox\";\nimport { checkedIcon, notCheckedIcon } from \"../../helpers/icons\";\n\nexport default class RulesView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\tlocalId: \"title\",\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\theight: 25,\n\t\t\t\t\t\t\tcss: \"webix_um_details_title\",\n\t\t\t\t\t\t\ttemplate: \"#name#\",\n\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\t\t\tlocalId: \"number\",\n\t\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\t\theight: 40,\n\t\t\t\t\t\t\t\t\tcss: \"webix_um_details_title_description\",\n\t\t\t\t\t\t\t\t\ttemplate: v => {\n\t\t\t\t\t\t\t\t\t\tconst number = v.rules ? v.rules.length : 0;\n\t\t\t\t\t\t\t\t\t\tlet descr = !number\n\t\t\t\t\t\t\t\t\t\t\t? _(\"No rules\")\n\t\t\t\t\t\t\t\t\t\t\t: `${_(\"Rules assigned\")} (${number})`;\n\t\t\t\t\t\t\t\t\t\treturn `<div class=\"webix_um_details_title_description\">${descr}</div>`;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trows: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\t\t\t\t\tlocalId: \"toggle\",\n\t\t\t\t\t\t\t\t\t\t\toffLabel: _(\"Modify\"),\n\t\t\t\t\t\t\t\t\t\t\tonLabel: _(\"Done\"),\n\t\t\t\t\t\t\t\t\t\t\twidth: 160,\n\t\t\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\t\t\tonChange: v => this.ToggleVisible(v),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"rules\",\n\t\t\trowHeight: webix.skin.$active.rowHeight > 30 ? 60 : 52,\n\t\t\trowLineHeight: 28,\n\t\t\tcss: \"webix_um_details_table webix_um_details_table_rules\",\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"selected\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\theader: { content: \"umMasterCheckox\", contentId: \"ch\" },\n\t\t\t\t\twidth: 45,\n\t\t\t\t\tcss: \"webix_um_checkbox_column\",\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn obj.selected ? checkedIcon : notCheckedIcon;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"name\",\n\t\t\t\t\theader: {\n\t\t\t\t\t\tcontent: \"textFilter\",\n\t\t\t\t\t\tcompare: this.GetCompare(),\n\t\t\t\t\t\tprepare: a => a.toLowerCase(),\n\t\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\t},\n\t\t\t\t\tfillspace: 2,\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tobj.short + `<div class='webix_um_details_row'>${obj.long}</div>`\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.Toggle(id.row * 1),\n\t\t\t\tonCustomSave: () => this.Save(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [form, table],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tthis.ID = this.getParam(\"id\", true);\n\t\tif (this.ID) this.GetData();\n\t}\n\n\tGetData() {\n\t\tconst local = this.app.getService(\"local\");\n\t\tthis.ShowAll = false;\n\n\t\tthis.$$(\"rules\").registerFilter(\n\t\t\tthis.$$(\"toggle\"),\n\t\t\t{\n\t\t\t\tcompare(_v1, _v2, obj) {\n\t\t\t\t\treturn obj.selected;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tgetValue: a => (a.getValue() ? \"\" : true),\n\t\t\t}\n\t\t);\n\n\t\treturn Promise.all([local.roles(), local.rules()]).then(data => {\n\t\t\tthis.Role = webix.copy(data[0].getItem(this.ID));\n\t\t\tthis.Role.rules = this.Role.rules || [];\n\n\t\t\tconst rules = data[1].serialize().map(({ id, short, long }) => ({\n\t\t\t\tid,\n\t\t\t\tshort,\n\t\t\t\tlong,\n\t\t\t\tselected: this.Role.rules.indexOf(id) !== -1,\n\t\t\t}));\n\t\t\tthis.$$(\"rules\").parse(rules);\n\t\t\tthis.$$(\"title\").setValues(this.Role);\n\t\t\tthis.ShowNumber();\n\t\t\tthis.Filter();\n\t\t});\n\t}\n\n\tSave() {\n\t\tthis.Role.rules = [];\n\t\tthis.$$(\"rules\").data.each(\n\t\t\ta => {\n\t\t\t\tif (a.selected) this.Role.rules.push(a.id);\n\t\t\t},\n\t\t\tthis,\n\t\t\ttrue\n\t\t);\n\t\tthis.ShowNumber();\n\t\tthis.app.getService(\"operations\").updateRole(this.Role.id, this.Role);\n\t}\n\n\tShowNumber() {\n\t\tthis.$$(\"number\").setValues(this.Role);\n\t}\n\n\tToggleVisible() {\n\t\tthis.ShowAll = !this.ShowAll;\n\n\t\tif (this.ShowAll) this.$$(\"rules\").showColumn(\"selected\");\n\t\telse this.$$(\"rules\").hideColumn(\"selected\");\n\n\t\tthis.Filter();\n\t}\n\n\tToggle(id) {\n\t\tif (!this.ShowAll) return;\n\t\tconst item = this.$$(\"rules\").getItem(id);\n\t\tthis.$$(\"rules\").updateItem(id, { selected: !item.selected });\n\t\tthis.Save();\n\t}\n\n\tFilter() {\n\t\tthis.$$(\"rules\").filterByAll();\n\t\tthis.$$(\"rules\").sort((a, b) =>\n\t\t\ta.selected == b.selected\n\t\t\t\t? a.short > b.short\n\t\t\t\t\t? 1\n\t\t\t\t\t: -1\n\t\t\t\t: a.selected\n\t\t\t\t? -1\n\t\t\t\t: 1\n\t\t);\n\t}\n\n\t// shows rows with short and long rule data in filtering results\n\tGetCompare() {\n\t\treturn (value, searchValue, rule) => {\n\t\t\treturn (\n\t\t\t\trule.short.toLowerCase().indexOf(searchValue) > -1 ||\n\t\t\t\trule.long.toLowerCase().indexOf(searchValue) > -1\n\t\t\t);\n\t\t};\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { getInfoList } from \"../../helpers/infolist\";\n\nexport default class DetailsView extends JetView {\n\tconfig() {\n\t\tthis.WithRoles = this.app.config.roles;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst padding = { left: 10 };\n\n\t\tconst headers = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"umi-back\",\n\t\t\t\t\tclick: () =>\n\t\t\t\t\t\tthis.app.callEvent(\"details.back:click\", [\n\t\t\t\t\t\t\t\"rules\",\n\t\t\t\t\t\t\tthis.getParam(\"id\", true),\n\t\t\t\t\t\t]),\n\t\t\t\t\thidden: !this.Compact,\n\t\t\t\t},\n\t\t\t\t{ view: \"label\", label: \"Rule information\" },\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\n\t\tconst details = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"title\",\n\t\t\tautoheight: true,\n\t\t\ttemplate: this.TitleTemplate,\n\t\t};\n\n\t\tconst info = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"info\",\n\t\t\tscroll: true,\n\t\t\tonClick: {\n\t\t\t\twebix_um_infolist_users_name: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"users\", id]);\n\t\t\t\t},\n\t\t\t\twebix_um_infolist_roles_name: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"roles\", id]);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tmaxWidth: this.Compact ? 10000 : 350,\n\t\t\trows: [\n\t\t\t\theaders,\n\t\t\t\t{\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [details, info],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tthis.ID = this.getParam(\"id\", true) * 1;\n\t\tconst local = this.app.getService(\"local\");\n\t\tlet colls = [local.users()];\n\t\tif (this.WithRoles) colls.push(local.roles());\n\t\tconst rules = local.rules(true);\n\t\trules.waitData.then(() => {\n\t\t\tif (!this.getRoot()) return;\n\n\t\t\tconst rule = rules.getItem(this.ID);\n\t\t\tthis.SetTitle(rule);\n\t\t\tPromise.all(colls).then(data => {\n\t\t\t\tthis.SetDetails(rule, data[0], data[1] || null);\n\t\t\t});\n\t\t});\n\t}\n\n\tSetTitle(rule) {\n\t\tthis.$$(\"title\").setValues(rule);\n\t}\n\n\tSetDetails(rule, allUsers, allRoles) {\n\t\tthis.$$(\"info\").setHTML(this.GetDetailsHTML(rule, allUsers, allRoles));\n\t}\n\n\tGetDetailsHTML(rule, allUsers, allRoles) {\n\t\treturn this.GetListsHTML(rule, allUsers, allRoles);\n\t}\n\n\tTitleTemplate(rule) {\n\t\treturn (\n\t\t\t`<div class='webix_um_title'>${rule.short || \"\"}</div>` +\n\t\t\t`<div class='webix_um_description'>${rule.long || \"\"}</div>`\n\t\t);\n\t}\n\tGetRoles(id, data) {\n\t\tlet roles = [];\n\t\tif (data)\n\t\t\tdata.data.each(function(role) {\n\t\t\t\tif (role.rules && role.rules.indexOf(id) >= 0) roles.push(role);\n\t\t\t});\n\t\treturn roles;\n\t}\n\n\tGetUsers(id, uData, rData) {\n\t\tlet users = [];\n\t\tuData.data.each(user => {\n\t\t\tif (user.rules && user.rules.indexOf(id) >= 0) users.push(user);\n\t\t\telse if (rData && this.WithRoles && user.roles) {\n\t\t\t\tfor (let i = 0; i < user.roles.length; i++) {\n\t\t\t\t\tlet role = rData.getItem(user.roles[i]);\n\t\t\t\t\tif (role.rules && role.rules.indexOf(id) >= 0) {\n\t\t\t\t\t\tusers.push(user);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn users;\n\t}\n\n\tGetAssignments(rule, allUsers, allRoles) {\n\t\tlet assigned = {};\n\t\tassigned.roles = this.GetRoles(rule.id, allRoles);\n\t\tassigned.users = this.GetUsers(rule.id, allUsers, allRoles);\n\t\treturn assigned;\n\t}\n\n\tGetListsHTML(rule, uData, rData) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tlet configs = [];\n\t\tlet assigned = this.GetAssignments(rule, uData, rData);\n\t\tif (this.WithRoles)\n\t\t\tconfigs.push({\n\t\t\t\tname: \"roles\",\n\t\t\t\tdata: assigned.roles,\n\t\t\t\tkey: \"name\",\n\t\t\t\ttitle: _(\"Roles\"),\n\t\t\t\ticon: \"umi-roles\",\n\t\t\t});\n\n\t\treturn getInfoList(\n\t\t\tconfigs.concat({\n\t\t\t\tname: \"users\",\n\t\t\t\tdata: assigned.users,\n\t\t\t\tkey: \"name\",\n\t\t\t\ttitle: _(\"Users\"),\n\t\t\t\ticon: \"umi-users\",\n\t\t\t})\n\t\t);\n\t}\n}\n","import BaseGrid from \"../sections/view\";\nimport Toolbar from \"../sections/toolbar\";\n\nimport { createState } from \"jet-restate\";\nimport { text } from \"helpers/templates\";\n\nexport default class RulesGrid extends BaseGrid {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.setParam(\"state\", createState({ name: _(\"Rules\"), search: \"\" }));\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst ui = super.config();\n\t\twebix.extend(\n\t\t\tui,\n\t\t\t{\n\t\t\t\trowHeight: webix.skin.$active.rowHeight + 10,\n\t\t\t\theaderRowHeight: webix.skin.$active.barHeight + 10,\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tui.columns = [\n\t\t\t{\n\t\t\t\tid: \"short\",\n\t\t\t\theader: _(\"Name\"),\n\t\t\t\tfillspace: 2,\n\t\t\t\tsort: \"string\",\n\t\t\t\ttemplate: text(this),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"long\",\n\t\t\t\theader: _(\"Description\"),\n\t\t\t\tfillspace: 2,\n\t\t\t\tsort: \"string\",\n\t\t\t\ttemplate: text(this),\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tmargin: 10,\n\t\t\tpadding: 10,\n\t\t\tcss: \"webix_um_tableview\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\trows: [Toolbar, ui],\n\t\t\t\t},\n\t\t\t\t{ $subview: \"_hidden\", name: \"default\" },\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst rules = this.app.getService(\"local\").rules(true);\n\t\tthis.InitSelf(rules, this.getParam(\"id\"));\n\t\tthis.on(this.app, \"rules.back:click\", () => this.HideDetails());\n\t}\n\n\tShowDetails(id) {\n\t\tthis.app.callEvent(\"details:item-click\", [\"rules\", id.toString()]);\n\t}\n\n\tSearchCompare(value, rule) {\n\t\treturn (\n\t\t\trule.short.toLowerCase().indexOf(value) > -1 ||\n\t\t\trule.long.toLowerCase().indexOf(value) > -1\n\t\t);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TopBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpaddingY: 9,\n\t\t\tpaddingX: 12,\n\t\t\tcss: \"webix_um_toolbar\",\n\t\t\tvisibleBatch: \"def\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"webix_icon umi-menu\",\n\t\t\t\t\tclick: () => this.app.callEvent(\"menu:click\", []),\n\t\t\t\t\thidden: !this.Compact,\n\t\t\t\t},\n\t\t\t\t{ view: \"label\", label: _(\"User Manager\") },\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"saving\",\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\twidth: 30,\n\t\t\t\t\tlabel:\n\t\t\t\t\t\t\"<span class='webix_icon webix_um_saving_icon umi-sync webix_spin'></span>\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"saved\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\tlabel: _(\"Done\"),\n\t\t\t\t\t\t\twidth: 130,\n\t\t\t\t\t\t\talign: \"right\",\n\t\t\t\t\t\t\tcss: \"webix_um_saved_label\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\twidth: 30,\n\t\t\t\t\t\t\tlabel:\n\t\t\t\t\t\t\t\t\"<span class='webix_icon umi-check-circle webix_um_saved_icon'></span>\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn bar;\n\t}\n\n\tinit() {\n\t\tthis.app.getService(\"progress\").handle(this.getRoot());\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"r-layout\",\n\t\tsizeTrigger(width, handler, value) {\n\t\t\tthis._compactValue = value;\n\t\t\tthis._compactWidth = width;\n\t\t\tthis._compactHandler = handler;\n\n\t\t\tthis._checkTrigger(this.$view.width, value);\n\t\t},\n\t\t_checkTrigger(x, value) {\n\t\t\tif (this._compactWidth) {\n\t\t\t\tif (\n\t\t\t\t\t(x <= this._compactWidth && !value) ||\n\t\t\t\t\t(x > this._compactWidth && value)\n\t\t\t\t) {\n\t\t\t\t\tthis._compactWidth = null;\n\t\t\t\t\tthis._compactHandler(!value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$setSize(x, y) {\n\t\t\tif (this._checkTrigger(x, this._compactValue))\n\t\t\t\treturn webix.ui.layout.prototype.$setSize.call(this, x, y);\n\t\t},\n\t},\n\twebix.ui.layout\n);\n","import { JetView } from \"webix-jet\";\n\nimport TopBar from \"./topbar\";\nimport SideBar from \"./sidebar\";\nimport SideMenu from \"./compact/sidemenu\";\nimport \"../helpers/responsive\";\n\nexport default class TopView extends JetView {\n\tconfig() {\n\t\tconst fCompact = this.getParam(\"forceCompact\");\n\t\tconst isForced = typeof fCompact !== \"undefined\";\n\t\tif (isForced) this.setParam(\"compact\", fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\n\t\tlet cols = this.Compact\n\t\t\t? [{ $subview: true }]\n\t\t\t: [SideBar, { $subview: true }];\n\t\treturn {\n\t\t\tborderless: true,\n\t\t\tview: isForced ? \"layout\" : \"r-layout\",\n\t\t\trows: [\n\t\t\t\tTopBar,\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"main\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tcols,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\t// responsive UI\n\t\tconst root = this.getRoot();\n\t\tif (root.sizeTrigger)\n\t\t\troot.sizeTrigger(\n\t\t\t\tthis.app.config.compactWidth,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\tthis.on(this.app, \"menu:click\", () => this.ShowSideMenu());\n\t\tthis.on(this.app, \"details:item-click\", (collection, id) =>\n\t\t\tthis.ShowDetails(collection, id)\n\t\t);\n\n\t\tthis.on(this.app, \"details.back:click\", (coll, id) =>\n\t\t\tthis.ShowList(coll, id)\n\t\t);\n\t}\n\turlChange() {\n\t\tthis.app.callEvent(\"top:navigation\");\n\t}\n\n\tSetCompactMode(mode) {\n\t\t// delay is necessary to prevent the refresh call\n\t\t// while this view is still in rendering process\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tShowSideMenu() {\n\t\tif (!this.SideMenu || !this.SideMenu.getRoot())\n\t\t\tthis.SideMenu = this.ui(SideMenu);\n\n\t\tconst box = this.$$(\"main\").$view.getBoundingClientRect();\n\t\tthis.SideMenu.Show(box);\n\t}\n\n\tShowDetails(collection, id) {\n\t\tconst details =\n\t\t\tthis.Compact && collection !== \"rules\" ? \"editor\" : \"details\";\n\t\tif (this.Compact) this.show(`./${collection}.${details}?id=${id}`);\n\t\telse this.show(`./${collection}?id=${id}/${collection}.${details}`);\n\t}\n\tShowList(collection, id) {\n\t\tif (this.Compact) {\n\t\t\tthis.show(`./${collection}`);\n\t\t} else {\n\t\t\tthis.show(`./${collection}?id=${id}/${collection}.details`);\n\t\t}\n\t}\n}\n","const dateMask = \"%M %d, %Y %H:%i:%s\";\n\nconst dateCommonFormat = webix.Date.dateToStr(dateMask);\nconst dateFromISO = string => new Date(string);\n\nexport { dateFromISO, dateCommonFormat };\n","import { JetView } from \"webix-jet\";\nimport { dateCommonFormat, dateFromISO } from \"../../helpers/dateFormat\";\n\nexport default class AuditView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Type = \"login\";\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\tlocalId: \"title\",\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\theight: 30,\n\t\t\t\t\t\t\tcss: \"webix_um_details_title\",\n\t\t\t\t\t\t\ttemplate: \"#name#\",\n\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\tlocalId: \"type\",\n\t\t\t\t\t\t\tvalue: this.Type,\n\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t{ id: \"login\", value: _(\"logins\") },\n\t\t\t\t\t\t\t\t{ id: \"user\", value: _(\"changes to\") },\n\t\t\t\t\t\t\t\t{ id: \"by-user\", value: _(\"changes by\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: t => this.ShowLogTable(t),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tthis.InitColumns(_);\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"audit\",\n\t\t\trowHeight: Math.max(webix.skin.$active.rowHeight, 34),\n\t\t\tcolumns: this.GetColumns(\"login\"),\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.ShowTarget(id),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [form, table],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {}\n\n\turlChange() {\n\t\tthis.$$(\"type\").setValue(this.Type);\n\t\tthis.ID = this.getParam(\"id\", true);\n\t\tif (this.ID) {\n\t\t\tconst local = this.app.getService(\"local\");\n\t\t\tPromise.all([local.users(), local.roles(), local.logsMeta()]).then(\n\t\t\t\tdata => {\n\t\t\t\t\tconst user = data[0].getItem(this.ID);\n\t\t\t\t\tthis.$$(\"title\").setValues(user);\n\t\t\t\t\tthis.ShowLogTable(this.Type);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tInitColumns(_) {\n\t\tconst local = this.app.getService(\"local\");\n\n\t\tconst date = {\n\t\t\tid: \"date\",\n\t\t\theader: _(\"When\"),\n\t\t\tfillspace: true,\n\t\t\tformat: value => dateCommonFormat(dateFromISO(value)),\n\t\t};\n\t\tconst user_id = {\n\t\t\tid: \"user_id\",\n\t\t\theader: _(\"Who\"),\n\t\t\tfillspace: true,\n\t\t\ttemplate: obj => {\n\t\t\t\tconst user = local.users(true).getItem(obj[\"user_id\"]);\n\t\t\t\treturn user\n\t\t\t\t\t? `<span class=\"webix_um_cell_clickable\">${user.name}</span>`\n\t\t\t\t\t: `<span class=\"webix_um_deleted_user\"> ${_(\"Deleted\")}</span>`;\n\t\t\t},\n\t\t};\n\n\t\tconst target_id = {\n\t\t\tid: \"target_id\",\n\t\t\theader: _(\"Target\"),\n\t\t\tfillspace: true,\n\t\t\ttemplate: obj => {\n\t\t\t\tconst target = this.GetTarget(obj).item;\n\t\t\t\treturn target\n\t\t\t\t\t? `<span class=\"webix_um_cell_clickable\">${target.name}</span>`\n\t\t\t\t\t: `<span class=\"webix_um_deleted_user\"> ${_(\"Deleted\")}</span>`;\n\t\t\t},\n\t\t};\n\t\tconst type = {\n\t\t\tid: \"type\",\n\t\t\theader: _(\"Operation\"),\n\t\t\ttemplate: obj => {\n\t\t\t\tconst type = local.logsMeta(true)[obj.type];\n\t\t\t\treturn type ? type.name : obj.type;\n\t\t\t},\n\t\t\tfillspace: true,\n\t\t};\n\n\t\tconst details = {\n\t\t\tid: \"details\",\n\t\t\tfillspace: true,\n\t\t\theader: _(\"Details\"),\n\t\t};\n\n\t\tthis.ColumnBatches = {\n\t\t\tlogin: [date, details],\n\t\t\tuser: [date, user_id, type, details],\n\t\t\t\"by-user\": [date, target_id, type, details],\n\t\t};\n\t}\n\n\tShowLogTable(type) {\n\t\tconst logs = this.app.getService(\"backend\").logs(type, this.ID);\n\t\tconst table = this.$$(\"audit\");\n\t\t// clearAll should be called before refreshing\n\t\ttable.clearAll();\n\t\ttable.refreshColumns(this.GetColumns(type));\n\t\tlogs.then(data => {\n\t\t\ttable.parse(data);\n\t\t});\n\t}\n\n\tGetColumns(type) {\n\t\treturn webix.copy(this.ColumnBatches[type]);\n\t}\n\n\tShowTarget(id) {\n\t\tconst column = id.column;\n\t\tif (column == \"target_id\" || column == \"user_id\") {\n\t\t\tconst item = this.$$(\"audit\").getItem(id);\n\t\t\tlet targetItem,\n\t\t\t\ttype = \"users\";\n\t\t\tif (column == \"target_id\") {\n\t\t\t\tconst target = this.GetTarget(item);\n\t\t\t\ttargetItem = target.item;\n\t\t\t\tif (target.type == \"role\") type = \"roles\";\n\t\t\t} else\n\t\t\t\ttargetItem = this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.users(true)\n\t\t\t\t\t.getItem(item[\"user_id\"]);\n\t\t\tif (targetItem)\n\t\t\t\tthis.app.callEvent(\"details:item-click\", [type, targetItem.id]);\n\t\t}\n\t}\n\n\tGetTarget(obj) {\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst type = local.logsMeta(true)[obj.type];\n\t\tconst data =\n\t\t\ttype && type.target == \"role\" ? local.roles(true) : local.users(true);\n\t\treturn {\n\t\t\titem: data.getItem(obj[\"target_id\"]),\n\t\t\ttype: type ? type.target : \"user\",\n\t\t};\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class CredentialsWinView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tmodal: true,\n\t\t\tmove: true,\n\t\t\twidth: 300,\n\t\t\theight: 300,\n\t\t\thead: {\n\t\t\t\tview: \"toolbar\",\n\t\t\t\tpadding: { left: 20, right: 9 },\n\t\t\t\tborderless: true,\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"label\", label: _(\"New password\") },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"icon\",\n\t\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\t\tclick: () => this.getRoot().close(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\tposition: \"center\",\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tlocalId: \"form\",\n\t\t\t\tpadding: { top: 20, left: 20, right: 20, bottom: 20 },\n\t\t\t\tmargin: 2,\n\t\t\t\telements: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\tlabel: _(\"Generate password\"),\n\t\t\t\t\t\tclick: () => this.GeneratePassword(),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\theight: 20,\n\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttemplate: \"<div class='webix_um_divider_line'/>\",\n\t\t\t\t\t\t\t\tcss: \"webix_um_divider\",\n\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\twidth: 40,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tmargin: 10,\n\t\t\t\t\t\trows: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabelPosition: \"top\",\n\t\t\t\t\t\t\t\tcss: \"webix_um_passw_label\",\n\t\t\t\t\t\t\t\tlabel: _(\"Enter password\"),\n\t\t\t\t\t\t\t\tview: \"text\",\n\t\t\t\t\t\t\t\tname: \"password\",\n\t\t\t\t\t\t\t\tvalidate: \"isNotEmpty\",\n\t\t\t\t\t\t\t\ttype: \"password\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\t\t\tlabel: _(\"Reset password\"),\n\t\t\t\t\t\t\t\tclick: () => this.ResetPassword(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonShow() {\n\t\t\t\t\tconst input = this.getBody().elements.password.getInputNode();\n\t\t\t\t\tinput.focus();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\tShow(id) {\n\t\tthis.getRoot().show();\n\t\tthis.ID = this.getParam(\"id\", true) * 1;\n\t\tthis.credID = id;\n\t}\n\n\tGeneratePassword() {\n\t\tthis.app.getService(\"backend\").resetPassword(this.ID, { id: this.credID });\n\t\tthis.getRoot().close();\n\t}\n\tResetPassword() {\n\t\tif (this.$$(\"form\").validate()) {\n\t\t\tconst record = this.$$(\"form\").getValues().password;\n\t\t\tthis.app\n\t\t\t\t.getService(\"backend\")\n\t\t\t\t.resetPassword(this.ID, { id: this.credID, record });\n\t\t\tthis.getRoot().close();\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { getInfoList } from \"../../helpers/infolist\";\nimport { dateCommonFormat, dateFromISO } from \"../../helpers/dateFormat\";\nimport { statusBadge, userAvatar } from \"helpers/templates\";\n\nexport default class UsersView extends JetView {\n\tconfig() {\n\t\tthis.WithRoles = this.app.config.roles;\n\t\tconst padding = { left: 10 };\n\t\tconst headers = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding,\n\t\t\tcols: [\n\t\t\t\t{ view: \"label\", label: \"User information\", width: 125 },\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tcss: \"webix_um_transparent\",\n\t\t\t\t\tlocalId: \"statusBadge\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t},\n\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\t\tclick: () => this.Edit(this.ID),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst userTemplate = {\n\t\t\tlocalId: \"title\",\n\t\t\ttemplate: \" \",\n\t\t\tautoheight: true,\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"info\",\n\t\t\ttemplate: \" \",\n\t\t\tscroll: \"auto\",\n\t\t\tonClick: {\n\t\t\t\twebix_um_infolist_rules_name: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"rules\", id]);\n\t\t\t\t},\n\t\t\t\twebix_um_infolist_roles_name: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"roles\", id]);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst userDetails = {\n\t\t\ttype: \"clean\",\n\t\t\trows: [userTemplate, info],\n\t\t};\n\n\t\treturn {\n\t\t\tmaxWidth: 350,\n\t\t\trows: [headers, userDetails],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis._ = this.app.getService(\"locale\")._;\n\t}\n\n\turlChange() {\n\t\tthis.ID = this.getParam(\"id\", true);\n\t\tconst local = this.app.getService(\"local\");\n\t\tlet colls = [local.rules()];\n\t\tif (this.WithRoles) colls.push(local.roles());\n\t\tconst users = local.users(true);\n\t\tusers.waitData.then(() => {\n\t\t\tif (!this.getRoot()) return;\n\n\t\t\tconst user = users.getItem(this.ID);\n\t\t\tthis.SetTitle(user);\n\t\t\tPromise.all(colls).then(data => {\n\t\t\t\tthis.SetDetails(user, data[0], data[1]);\n\t\t\t});\n\t\t});\n\t}\n\n\tSetTitle(user) {\n\t\tthis.$$(\"statusBadge\").setHTML(statusBadge(user.status, this._));\n\t\tthis.$$(\"title\").setHTML(this.TitleTemplate(user));\n\t}\n\n\tSetDetails(user, rules, roles) {\n\t\tthis.$$(\"info\").setHTML(this.GetDetailsHTML(user, roles, rules));\n\t}\n\n\tGetDetailsHTML(user, roles, rules) {\n\t\tlet userDetails = \"\";\n\t\tuserDetails += this.InfoTemplate(user.email, this._(\"Email\"), \"umi-email\");\n\t\tuserDetails += this.InfoTemplate(\n\t\t\tthis.FormatDate(user.visited),\n\t\t\tthis._(\"Last visited\"),\n\t\t\t\"umi-clock\"\n\t\t);\n\n\t\tuserDetails += this.GetListsHTML(user, roles, rules);\n\n\t\treturn userDetails;\n\t}\n\n\tGetListsHTML(user, rolesData, rulesData) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst assignedStats = this.GetAssignments(user, rolesData, rulesData);\n\t\tlet configs = [];\n\t\tif (this.WithRoles)\n\t\t\tconfigs.push({\n\t\t\t\tname: \"roles\",\n\t\t\t\tdata: assignedStats.roles,\n\t\t\t\tkey: \"name\",\n\t\t\t\ttitle: _(\"Roles\"),\n\t\t\t\ticon: \"umi-roles\",\n\t\t\t});\n\t\treturn getInfoList(\n\t\t\tconfigs.concat({\n\t\t\t\tname: \"rules\",\n\t\t\t\tdata: assignedStats.rules,\n\t\t\t\tkey: \"long\",\n\t\t\t\ttitle: _(\"Rules\"),\n\t\t\t\ticon: \"umi-rules\",\n\t\t\t})\n\t\t);\n\t}\n\n\tGetAssignments(user, roles, rules) {\n\t\tconst stats = {};\n\n\t\tstats.roles = [];\n\t\tstats.rules = [];\n\n\t\tif (this.WithRoles && user.roles) {\n\t\t\troles.data.each(role => {\n\t\t\t\tif (user.roles.indexOf(role.id) >= 0) {\n\t\t\t\t\tstats.roles.push(role);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst rulesHash = {};\n\t\t// get rules assigned directly to a user (if any)\n\t\tif (user.rules) {\n\t\t\trules.data.each(rule => {\n\t\t\t\tif (user.rules.indexOf(rule.id) >= 0 && !rulesHash[rule.id]) {\n\t\t\t\t\trulesHash[rule.id] = true;\n\t\t\t\t\tstats.rules.push(rule);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t// get rules according to assigned roles\n\t\tif (this.WithRoles)\n\t\t\tstats.roles.forEach(role => {\n\t\t\t\tif (role.rules) {\n\t\t\t\t\trules.data.each(rule => {\n\t\t\t\t\t\tif (role.rules.indexOf(rule.id) >= 0 && !rulesHash[rule.id]) {\n\t\t\t\t\t\t\trulesHash[rule.id] = true;\n\t\t\t\t\t\t\tstats.rules.push(rule);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn stats;\n\t}\n\n\tTitleTemplate(user) {\n\t\treturn `\n\t\t\t${userAvatar(user, \"webix_um_avatarbox\")}\n\t\t\t<div class=\"webix_um_title\">${user.name || this._(\"Unknown user\")}</div>`;\n\t}\n\n\tInfoTemplate(value, title, icon) {\n\t\tlet result = `\n\t\t\t<div class='webix_um_infolist_header'><span class='webix_icon ${icon}'></span> ${title ||\n\t\t\tthis._(\"Unknown\")}:</div>\n\t\t\t<div class='webix_um_infolist_details'>${value || this._(\"Unknown\")}</div>\n\t\t`;\n\n\t\treturn result;\n\t}\n\n\tFormatDate(value) {\n\t\tif (value) {\n\t\t\tvalue = dateFromISO(value);\n\t\t\tvalue = dateCommonFormat(value);\n\t\t}\n\t\treturn value || \"\";\n\t}\n\n\tEdit() {\n\t\tthis.show(\"../users.editor\");\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EditorView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tlet options = [\n\t\t\t{ id: \"users.form\", value: _(\"General\") },\n\t\t\t{ id: \"users.rules\", value: _(\"Rules\") },\n\t\t\t{ id: \"users.audit\", value: _(\"Audit\") },\n\t\t];\n\t\t// The last should be Audit panel\n\t\tif (this.app.config.roles)\n\t\t\toptions.splice(2, 0, { id: \"users.roles\", value: _(\"Roles\") });\n\n\t\tconst tabbar = {\n\t\t\tview: \"tabbar\",\n\t\t\tlocalId: \"tabbar\",\n\t\t\tcss: \"webix_um_editor_tabbar\",\n\t\t\theight: webix.skin.$active.barHeight - 2,\n\t\t\ttype: \"bottom\",\n\t\t\toptions: options,\n\t\t\tborderless: true,\n\t\t\ton: {\n\t\t\t\tonChange: v => this.SetMode(v),\n\t\t\t},\n\t\t};\n\n\t\tconst toolbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding: {\n\t\t\t\tleft: 2,\n\t\t\t\tright: 0,\n\t\t\t\ttop: 0,\n\t\t\t\tbottom: 0,\n\t\t\t},\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"umi-back\",\n\t\t\t\t\tclick: () =>\n\t\t\t\t\t\tthis.app.callEvent(\"details.back:click\", [\n\t\t\t\t\t\t\t\"users\",\n\t\t\t\t\t\t\tthis.getParam(\"id\", true),\n\t\t\t\t\t\t]),\n\t\t\t\t},\n\t\t\t\ttabbar,\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\trows: [toolbar, { $subview: true }],\n\t\t};\n\t}\n\n\tinit() {\n\t\tif (this.getUrl().length < 2) this.show(\"./users.form\");\n\t\telse this.$$(\"tabbar\").setValue(this.getUrl()[1].page);\n\t}\n\tSetMode(v) {\n\t\tthis.show(v);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { dateFromISO, dateCommonFormat } from \"../../helpers/dateFormat\";\nimport { statusBadge, userAvatar } from \"helpers/templates\";\n\nimport CredentialsWin from \"views/users/credentials\";\n\nexport default class UsersView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst buttons = {\n\t\t\tview: \"form\",\n\t\t\tmargin: 10,\n\t\t\tcols: [\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\twidth: 120,\n\t\t\t\t\tvalue: _(\"Delete\"),\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tclick: () => this.Delete(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\twidth: 120,\n\t\t\t\t\tvalue: _(\"Save\"),\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: () => this.Save(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst info = {\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\tbuttons,\n\t\t\t\t{\n\t\t\t\t\tview: \"form\",\n\t\t\t\t\tlocalId: \"form\",\n\t\t\t\t\tmargin: 20,\n\t\t\t\t\tcss: \"webix_um_edit_form\",\n\t\t\t\t\tscroll: \"auto\",\n\t\t\t\t\telementsConfig: {\n\t\t\t\t\t\tlabelAlign: \"right\",\n\t\t\t\t\t\tlabelWidth: 130,\n\t\t\t\t\t},\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"text\",\n\t\t\t\t\t\t\t\t\tlabel: _(\"Full Name\"),\n\t\t\t\t\t\t\t\t\tlocalId: \"focus\",\n\t\t\t\t\t\t\t\t\tname: \"name\",\n\t\t\t\t\t\t\t\t\tgravity: 2,\n\t\t\t\t\t\t\t\t\tmaxWidth: 550,\n\t\t\t\t\t\t\t\t\tminWidth: 420,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"text\",\n\t\t\t\t\t\t\t\t\tlabel: _(\"Email\"),\n\t\t\t\t\t\t\t\t\tname: \"email\",\n\t\t\t\t\t\t\t\t\tgravity: 2,\n\t\t\t\t\t\t\t\t\tmaxWidth: 550,\n\t\t\t\t\t\t\t\t\tminWidth: 420,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"forminput\",\n\t\t\t\t\t\t\t\t\tlabel: _(\"Avatar\"),\n\t\t\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\t\t\tlocalId: \"avatar\",\n\t\t\t\t\t\t\t\t\t\tcss: \"webix_um_form_avatar\",\n\t\t\t\t\t\t\t\t\t\twidth: 95,\n\t\t\t\t\t\t\t\t\t\theight: 95,\n\t\t\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\t\t\ttemplate: user => {\n\t\t\t\t\t\t\t\t\t\t\treturn `${userAvatar(user, \"webix_um_avatarbox\")}`;\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trows: [\n\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"uploader\",\n\t\t\t\t\t\t\t\t\t\t\tlocalId: \"avatarUpl\",\n\t\t\t\t\t\t\t\t\t\t\taccept: \"image/*\",\n\t\t\t\t\t\t\t\t\t\t\tautowidth: true,\n\t\t\t\t\t\t\t\t\t\t\tautosend: true,\n\t\t\t\t\t\t\t\t\t\t\tlabel: _(\"Upload new photo\"),\n\t\t\t\t\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\t\t\t\t\ticon: \"umi-upload\",\n\t\t\t\t\t\t\t\t\t\t\tcss: \"webix_transparent webix_um_uploader\",\n\t\t\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\t\t\tonAfterFileAdd: fileData => this.UpdateAvatar(fileData),\n\t\t\t\t\t\t\t\t\t\t\t\tonUploadComplete: response =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.UpdateAvatar(response),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// because for now we receive a number `0` and have only two known states\n\t\t\t\t\t\t\tview: \"switch\",\n\t\t\t\t\t\t\tname: \"status\",\n\t\t\t\t\t\t\tlocalId: \"status\",\n\t\t\t\t\t\t\tlabel: _(\"Status\"),\n\t\t\t\t\t\t\tcss: \"webix_um_status_switch\",\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: value => this.UpdateBadge(value),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"forminput\",\n\t\t\t\t\t\t\tlabel: _(\"Registered\"),\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\t\tlocalId: \"registeredDate\",\n\t\t\t\t\t\t\t\tcss: \"webix_um_text_normal\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"forminput\",\n\t\t\t\t\t\t\tlabel: _(\"Last visited\"),\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\t\tlocalId: \"visitedDate\",\n\t\t\t\t\t\t\t\tcss: \"webix_um_text_normal\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvisibleBatch: \"def\",\n\t\t\t\t\t\t\tlocalId: \"credentials\",\n\t\t\t\t\t\t\tcss: \"webix_um_credentials\",\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"label\",\n\t\t\t\t\t\t\t\t\tlabel: _(\"Credentials\"),\n\t\t\t\t\t\t\t\t\twidth: 130,\n\t\t\t\t\t\t\t\t\tcss: \"webix_um_form_label\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbatch: \"def\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbatch: \"no-credentials\",\n\t\t\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\t\t\t\t\tlabel: _(\"Add credentials\"),\n\t\t\t\t\t\t\t\t\t\t\twidth: 160,\n\t\t\t\t\t\t\t\t\t\t\tclick: () => this.AddCredentials(),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbatch: \"credentials\",\n\t\t\t\t\t\t\t\t\tmargin: 5,\n\t\t\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\t\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\t\t\t\t\t\t\t\tlabel: _(\"Reset password\"),\n\t\t\t\t\t\t\t\t\t\t\twidth: 140,\n\t\t\t\t\t\t\t\t\t\t\tclick: () => this.ResetPassword(),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\t\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\t\t\t\t\t\t\t\tlabel: _(\"Delete credentials\"),\n\t\t\t\t\t\t\t\t\t\t\twidth: 150,\n\t\t\t\t\t\t\t\t\t\t\tclick: () => this.DeleteCredentials(),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\t\t\t\t\tname: \"details\",\n\t\t\t\t\t\t\t\t\tlabel: _(\"Details\"),\n\t\t\t\t\t\t\t\t\theight: 128,\n\t\t\t\t\t\t\t\t\tgravity: 2,\n\t\t\t\t\t\t\t\t\tmaxWidth: 550,\n\t\t\t\t\t\t\t\t\tminWidth: 420,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\treturn info;\n\t}\n\n\turlChange() {\n\t\tthis.ID = this.getParam(\"id\", true) * 1;\n\t\tthis.ShowCredentials();\n\t\tthis.$$(\"avatarUpl\").config.upload = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.avatar(this.ID);\n\n\t\tthis.app\n\t\t\t.getService(\"local\")\n\t\t\t.users()\n\t\t\t.then(data => {\n\t\t\t\tconst user = data.getItem(this.ID);\n\t\t\t\tthis.$$(\"form\").setValues(user);\n\t\t\t\tthis.$$(\"focus\").focus();\n\t\t\t\t// render initial templates\n\t\t\t\tthis.$$(\"registeredDate\").setValue(this.FormatDate(user.registered));\n\t\t\t\tthis.$$(\"visitedDate\").setValue(this.FormatDate(user.visited));\n\t\t\t\tthis.$$(\"avatar\").setValues(user);\n\t\t\t});\n\t}\n\n\tSave() {\n\t\tconst form = this.$$(\"form\");\n\n\t\tthis.app.getService(\"operations\").updateUser(this.ID, form.getValues());\n\t}\n\n\tDelete() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete\"),\n\t\t\t\tok: _(\"Delete\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to delete this user?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.app.getService(\"operations\").deleteUser(this.ID);\n\t\t\t\tthis.app.show(\"/top/users/_hidden\");\n\t\t\t});\n\t}\n\n\tUpdateBadge(value) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst control = this.$$(\"status\");\n\n\t\tlet html = statusBadge(value, _);\n\t\tcontrol.config.labelRight = html;\n\t\tcontrol.refresh();\n\t}\n\n\tUpdateAvatar(data) {\n\t\tif (data.status === \"client\" && data.file) {\n\t\t\t// client-side preview\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = () => {\n\t\t\t\tthis.SetLocalAvatar(reader.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(data.file);\n\t\t} else if (data.status === \"server\") {\n\t\t\t// refresh picture after uploading, update data in form\n\t\t\tconst avatar = data.value;\n\t\t\tthis.$$(\"form\").setValues({ avatar }, true);\n\t\t\tthis.SetLocalAvatar(avatar);\n\t\t}\n\t}\n\n\tSetLocalAvatar(avatar) {\n\t\tthis.$$(\"avatar\").setValues({ avatar });\n\t\t// local update. Otherwise, we need to send _all_ user data to the server\n\t\tthis.app\n\t\t\t.getService(\"local\")\n\t\t\t.users()\n\t\t\t.then(data => {\n\t\t\t\tdata.updateItem(this.ID, { avatar });\n\t\t\t});\n\t}\n\n\tFormatDate(date) {\n\t\tif (date) {\n\t\t\tdate = dateFromISO(date);\n\t\t\tdate = dateCommonFormat(date);\n\t\t}\n\t\treturn date || \"\";\n\t}\n\n\tShowCredentials() {\n\t\tlet p = this.app.getService(\"backend\").credentials(this.ID);\n\t\tp.then(data => {\n\t\t\tconst batch = data.length ? \"credentials\" : \"no-credentials\";\n\t\t\tthis.credID = data.length ? data[0].id : null;\n\t\t\tthis.$$(\"credentials\").showBatch(batch);\n\t\t});\n\t}\n\n\tAddCredentials() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (!this.CheckEmail())\n\t\t\treturn webix.alert({\n\t\t\t\ttype: \"alert-error\",\n\t\t\t\ttitle: _(\"Error: no email\"),\n\t\t\t\ttext: _(\"Please submit an email first!\"),\n\t\t\t});\n\t\tconst data = { user_id: this.ID, source: 1, record: \"test\" };\n\t\tlet p = this.app.getService(\"backend\").addCredentials(this.ID, data);\n\t\tp.then(response => {\n\t\t\tif (response.id) {\n\t\t\t\tthis.credID = response.id;\n\t\t\t\tthis.$$(\"credentials\").showBatch(\"credentials\");\n\t\t\t}\n\t\t});\n\t}\n\n\tCheckEmail() {\n\t\tconst users = this.app.getService(\"local\").users(true);\n\t\treturn users.getItem(this.ID).email;\n\t}\n\n\tResetPassword() {\n\t\tthis.ui(CredentialsWin).Show(this.credID);\n\t}\n\n\tDeleteCredentials() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete\"),\n\t\t\t\tok: _(\"Delete\"),\n\t\t\t\tcancel: _(\"Cancel\"),\n\t\t\t\ttext: _(\"Are you sure to delete credentials?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tlet p = this.app\n\t\t\t\t\t.getService(\"backend\")\n\t\t\t\t\t.deleteCredentials(this.ID, this.credID);\n\t\t\t\tp.then(data => {\n\t\t\t\t\tif (data.id) this.ShowCredentials();\n\t\t\t\t});\n\t\t\t});\n\t}\n}\n","import BaseGrid from \"../sections/view\";\nimport { text, statusBadge, userAvatar } from \"../../helpers/templates\";\n\nexport default class GridView extends BaseGrid {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst ui = super.config();\n\t\twebix.extend(\n\t\t\tui,\n\t\t\t{\n\t\t\t\trowHeight: Math.max(\n\t\t\t\t\twebix.skin.$active.rowHeight +\n\t\t\t\t\t\tMath.round(webix.skin.$active.rowHeight * 0.55),\n\t\t\t\t\t40\n\t\t\t\t),\n\t\t\t\theaderRowHeight: webix.skin.$active.barHeight + 10,\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tui.columns = [\n\t\t\t{\n\t\t\t\tid: \"avatar\",\n\t\t\t\theader: \"\",\n\t\t\t\twidth: 70,\n\t\t\t\tcss: \"webix_um_center_column \",\n\t\t\t\ttemplate: user => {\n\t\t\t\t\treturn userAvatar(\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\"webix_um_member_avatar webix_um_member_avatar_big\"\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"name\",\n\t\t\t\theader: _(\"Full Name\"),\n\t\t\t\tfillspace: 2,\n\t\t\t\tsort: \"string\",\n\t\t\t\ttemplate: text(this),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"status\",\n\t\t\t\theader: _(\"Status\"),\n\t\t\t\twidth: 150,\n\t\t\t\ttemplate: (data, type, value) => statusBadge(value, _),\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"email\",\n\t\t\t\theader: _(\"Email\"),\n\t\t\t\tfillspace: 2,\n\t\t\t\tsort: \"string\",\n\t\t\t\ttemplate: text(this),\n\t\t\t},\n\t\t];\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tconst users = this.app.getService(\"local\").users(true);\n\t\tthis.InitSelf(users, this.getParam(\"id\", true));\n\t}\n\n\tShowDetails(id) {\n\t\tthis.getParentView().ShowDetails(id);\n\t}\n\n\tSearchCompare(value, user) {\n\t\treturn (\n\t\t\tuser.name.toLowerCase().indexOf(value) > -1 ||\n\t\t\tuser.email.toLowerCase().indexOf(value) > -1\n\t\t);\n\t}\n}\n","import Toolbar from \"../sections/toolbar\";\n\nexport default class ToolbarView extends Toolbar {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\");\n\t\tconst ui = super.config();\n\t\tui.rows[0].cols.push({\n\t\t\tview: \"toggle\",\n\t\t\twidth: 150,\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"umi-matrix\",\n\t\t\tlabel: this.app.config.roles ? _(\"Role Matrix\") : _(\"Rule Matrix\"),\n\t\t\ton: {\n\t\t\t\tonChange: v => this.ToggleVisible(v, state),\n\t\t\t},\n\t\t});\n\n\t\treturn ui;\n\t}\n\n\tToggleVisible(v, state) {\n\t\tstate.mode = v ? \"matrix\" : \"grid\";\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport Toolbar from \"./toolbar\";\n\nimport { createState } from \"jet-restate\";\n\nexport default class UsersView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tthis.setParam(\n\t\t\t\"state\",\n\t\t\tcreateState({ mode: \"grid\", name: _(\"Users\"), search: \"\" })\n\t\t);\n\n\t\treturn {\n\t\t\tmargin: 10,\n\t\t\tpadding: 10,\n\t\t\tcss: \"webix_um_tableview\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\trows: [\n\t\t\t\t\t\tToolbar,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$subview: true,\n\t\t\t\t\t\t\tname: \"center\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{ $subview: \"_hidden\", name: \"default\" },\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.on(this.getParam(\"state\").$changes, \"mode\", v => {\n\t\t\tlet path = \"users.\" + v;\n\t\t\tif (v === \"matrix\" && !this.app.config.roles) path = \"users.rulematrix\";\n\t\t\tthis.show(path, { target: \"center\" });\n\t\t\tif (v === \"matrix\") {\n\t\t\t\tthis.setParam(\"id\", null);\n\t\t\t\tthis.show(\"./_hidden\");\n\t\t\t}\n\t\t});\n\t}\n\n\tShowDetails(id) {\n\t\tconst now = this.getParam(\"id\");\n\t\tconst next = id.toString();\n\n\t\tif (this.getParam(\"compact\", true) || !now) {\n\t\t\tthis.app.callEvent(\"details:item-click\", [\"users\", next]);\n\t\t} else if (now !== next) {\n\t\t\tthis.setParam(\"id\", next, true);\n\t\t}\n\t}\n\n\tHideEditor() {\n\t\tif (this.Compact) {\n\t\t\tthis.show(\"../users/_hidden\");\n\t\t} else {\n\t\t\tthis.show(\"users.details\");\n\t\t}\n\t}\n}\n","import BaseGrid from \"../sections/view\";\nimport { text } from \"../../helpers/templates\";\nimport { checkedIconAlt, notCheckedIconAlt } from \"../../helpers/icons\";\n\nexport default class MatrixView extends BaseGrid {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tthis.Sorting = { column: \"\", dir: \"\" };\n\n\t\twebix.extend(\n\t\t\tui,\n\t\t\t{\n\t\t\t\tcss: \"webix_um_matrix\",\n\t\t\t\trowHeight: 56,\n\t\t\t\theaderRowHeight: 56,\n\t\t\t\tleftSplit: 1,\n\t\t\t\tselect: false,\n\t\t\t\ton: {\n\t\t\t\t\tonItemClick: id => this.Toggle(id),\n\t\t\t\t\t// to sort descendant by default\n\t\t\t\t\tonHeaderClick: header => this.ToggleColumnSorting(header.column),\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn this.GetRoleColumns().then(roles => {\n\t\t\tui.columns = [\n\t\t\t\t{\n\t\t\t\t\tid: \"name\",\n\t\t\t\t\theader: \"\",\n\t\t\t\t\twidth: 220,\n\t\t\t\t\tcss: \"webix_um_column_name\",\n\t\t\t\t\tsort: \"string\",\n\t\t\t\t\ttemplate: text(this),\n\t\t\t\t},\n\t\t\t\t...roles,\n\t\t\t];\n\n\t\t\treturn ui;\n\t\t});\n\t}\n\n\tinit() {\n\t\treturn this.GetData();\n\t}\n\n\tGetData() {\n\t\tconst local = this.app.getService(\"local\");\n\t\treturn Promise.all([local.roles(), local.users()]).then(res => {\n\t\t\tconst data = this.CreateMatrix(res[0], res[1]);\n\t\t\tthis.InitSelf(data);\n\t\t});\n\t}\n\n\tSearchCompare(value, user) {\n\t\treturn user.name.toLowerCase().indexOf(value) > -1;\n\t}\n\n\tSave(id) {\n\t\tlet user = this.app\n\t\t\t.getService(\"local\")\n\t\t\t.users(true)\n\t\t\t.getItem(id);\n\t\tconst gridUser = this.$$(\"table\").getItem(id);\n\t\tuser.roles = [];\n\t\tconst roles = this.app.getService(\"local\").roles(true);\n\t\troles.data.each(role => {\n\t\t\tif (gridUser[role.id]) user.roles.push(role.id);\n\t\t});\n\t\tthis.app.getService(\"operations\").updateUser(id, user);\n\t}\n\n\tToggle(id) {\n\t\tlet item = this.$$(\"table\").getItem(id);\n\t\tconst column = id.column;\n\t\tif (column != \"name\") {\n\t\t\titem[column] = !item[column];\n\t\t\titem.selected = !item.selected;\n\t\t\tthis.$$(\"table\").updateItem(id, item);\n\t\t\tthis.Save(id);\n\t\t}\n\t}\n\n\tGetRoleColumns() {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.roles()\n\t\t\t.then(roles => {\n\t\t\t\tconst columns = [];\n\t\t\t\troles.data.each(role => {\n\t\t\t\t\tcolumns.push({\n\t\t\t\t\t\tid: role.id,\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\ttext: `<span>${role.name}</span>`,\n\t\t\t\t\t\t\tcss: \"webix_um_center_column webix_um_names\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tminWidth: 100,\n\t\t\t\t\t\tfillspace: 1,\n\t\t\t\t\t\tcss: \"webix_um_center_column\",\n\t\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\t\treturn obj[role.id] ? checkedIconAlt : notCheckedIconAlt;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn columns;\n\t\t\t});\n\t}\n\n\tCreateMatrix(rolesData, users) {\n\t\tlet index = 0;\n\t\tconst data = users.serialize().map(({ id, name, roles }) => {\n\t\t\tlet roleAssigned = {};\n\t\t\trolesData.data.each(role => {\n\t\t\t\troleAssigned[role.id] = roles ? roles.indexOf(role.id) > -1 : false;\n\t\t\t});\n\t\t\treturn { id, name, $index: index++, ...roleAssigned };\n\t\t});\n\t\treturn data;\n\t}\n\n\tToggleColumnSorting(column) {\n\t\tif (column != \"name\") {\n\t\t\tlet dir =\n\t\t\t\tthis.Sorting.column == column && this.Sorting.dir == \"desc\"\n\t\t\t\t\t? \"asc\"\n\t\t\t\t\t: \"desc\";\n\t\t\tthis.$$(\"table\").sort({ by: column, dir: dir, as: \"string\" });\n\t\t\tthis.$$(\"table\").markSorting(column, dir);\n\t\t\tthis.Sorting.dir = dir;\n\t\t}\n\t\tthis.Sorting.column = column;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { checkedIcon, notCheckedIcon } from \"../../helpers/icons\";\nimport { roleAvatar } from \"../../helpers/templates\";\n\nexport default class RolesView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\tlocalId: \"title\",\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\theight: 30,\n\t\t\t\t\t\t\tcss: \"webix_um_details_title\",\n\t\t\t\t\t\t\ttemplate: \"#name#\",\n\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\t\t\tlocalId: \"number\",\n\t\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\t\tcss: \"webix_um_details_title_description\",\n\t\t\t\t\t\t\t\t\ttemplate: v => {\n\t\t\t\t\t\t\t\t\t\tconst number = v.roles ? v.roles.length : 0;\n\t\t\t\t\t\t\t\t\t\tlet descr = !number\n\t\t\t\t\t\t\t\t\t\t\t? _(\"No roles\")\n\t\t\t\t\t\t\t\t\t\t\t: `${_(\"Roles assigned\")} (${number})`;\n\t\t\t\t\t\t\t\t\t\treturn `<div class=\"webix_um_details_title_description\">${descr}</div>`;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\t\t\tlocalId: \"toggle\",\n\t\t\t\t\t\t\t\t\toffLabel: _(\"Modify\"),\n\t\t\t\t\t\t\t\t\tonLabel: _(\"Done\"),\n\t\t\t\t\t\t\t\t\twidth: 160,\n\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\tonChange: v => this.ToggleVisible(v),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"roles\",\n\t\t\tcss: \"webix_um_details_table\",\n\t\t\trowHeight: webix.skin.$active.rowHeight + 10,\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"selected\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\theader: \"\",\n\t\t\t\t\twidth: 45,\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn obj.selected ? checkedIcon : notCheckedIcon;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"name\",\n\t\t\t\t\theader: {\n\t\t\t\t\t\tcontent: \"textFilter\",\n\t\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\t\tprepare: a => a.toLowerCase(),\n\t\t\t\t\t},\n\t\t\t\t\tfillspace: 2,\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: role => {\n\t\t\t\t\t\treturn roleAvatar(role) + role.name;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.Toggle(id.row * 1),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [form, table],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.$$(\"roles\").registerFilter(\n\t\t\tthis.$$(\"toggle\"),\n\t\t\t{\n\t\t\t\tcompare(_v1, _v2, obj) {\n\t\t\t\t\treturn obj.selected;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tgetValue: a => (a.getValue() ? \"\" : true),\n\t\t\t}\n\t\t);\n\t}\n\n\turlChange() {\n\t\tthis.GetData();\n\t}\n\n\tGetData() {\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst id = this.getParam(\"id\", true);\n\t\tthis.ShowAll = false;\n\n\t\treturn Promise.all([local.users(), local.roles()]).then(data => {\n\t\t\tthis.User = webix.copy(data[0].getItem(id));\n\t\t\tthis.User.roles = this.User.roles || [];\n\t\t\tconst roles = data[1].serialize().map(({ id, name, color }) => ({\n\t\t\t\tid,\n\t\t\t\tcolor,\n\t\t\t\tname,\n\t\t\t\tselected: this.User.roles.indexOf(id) !== -1,\n\t\t\t}));\n\t\t\tthis.$$(\"roles\").parse(roles);\n\t\t\tthis.$$(\"title\").setValues(this.User);\n\t\t\tthis.ShowNumber();\n\t\t\tthis.Filter();\n\t\t});\n\t}\n\n\tSave() {\n\t\tthis.User.roles = [];\n\t\tthis.$$(\"roles\").data.each(\n\t\t\ta => {\n\t\t\t\tif (a.selected) this.User.roles.push(a.id);\n\t\t\t},\n\t\t\tthis,\n\t\t\ttrue\n\t\t);\n\t\tthis.ShowNumber();\n\t\tthis.app.getService(\"operations\").updateUser(this.User.id, this.User);\n\t}\n\n\tShowNumber() {\n\t\tthis.$$(\"number\").setValues(this.User);\n\t}\n\n\tToggleVisible() {\n\t\tthis.ShowAll = !this.ShowAll;\n\n\t\tif (this.ShowAll) this.$$(\"roles\").showColumn(\"selected\");\n\t\telse this.$$(\"roles\").hideColumn(\"selected\");\n\n\t\tthis.Filter();\n\t}\n\n\tToggle(id) {\n\t\tif (!this.ShowAll) return;\n\t\tconst item = this.$$(\"roles\").getItem(id);\n\t\tthis.$$(\"roles\").updateItem(id, { selected: !item.selected });\n\t\tthis.Save();\n\t}\n\n\tFilter() {\n\t\tthis.$$(\"roles\").filterByAll();\n\t\tthis.$$(\"roles\").sort((a, b) =>\n\t\t\ta.selected == b.selected\n\t\t\t\t? a.name > b.name\n\t\t\t\t\t? 1\n\t\t\t\t\t: -1\n\t\t\t\t: a.selected\n\t\t\t\t? -1\n\t\t\t\t: 1\n\t\t);\n\t}\n}\n","import BaseGrid from \"../sections/view\";\nimport { rule } from \"../../helpers/templates\";\nimport { checkedIconAlt, notCheckedIconAlt } from \"../../helpers/icons\";\n\nexport default class MatrixView extends BaseGrid {\n\tconfig() {\n\t\tthis.Sorting = { column: \"\", dir: \"\" };\n\n\t\tconst ui = super.config();\n\n\t\twebix.extend(\n\t\t\tui,\n\t\t\t{\n\t\t\t\tcss: \"webix_um_matrix\",\n\t\t\t\theaderRowHeight: 56,\n\t\t\t\trowHeight: 62,\n\t\t\t\trowLineHeight: 29,\n\t\t\t\tleftSplit: 1,\n\t\t\t\tselect: false,\n\t\t\t\ton: {\n\t\t\t\t\tonItemClick: id => this.Toggle(id),\n\t\t\t\t\t// to sort descendant by default\n\t\t\t\t\tonHeaderClick: header => this.ToggleColumnSorting(header.column),\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn this.GetUserColumns().then(users => {\n\t\t\tui.columns = [\n\t\t\t\t{\n\t\t\t\t\tid: \"short\",\n\t\t\t\t\theader: \"\",\n\t\t\t\t\twidth: 220,\n\t\t\t\t\tcss: \"webix_um_column_name\",\n\t\t\t\t\tsort: \"string\",\n\t\t\t\t\ttemplate: rule(this),\n\t\t\t\t},\n\t\t\t\t...users,\n\t\t\t];\n\n\t\t\treturn ui;\n\t\t});\n\t}\n\n\tinit() {\n\t\treturn this.GetData();\n\t}\n\n\tGetData() {\n\t\tconst local = this.app.getService(\"local\");\n\t\treturn Promise.all([local.users(), local.rules()]).then(res => {\n\t\t\tconst data = this.CreateMatrix(res[0], res[1]);\n\t\t\tthis.InitSelf(data);\n\t\t});\n\t}\n\n\tSearchCompare(value, rule) {\n\t\treturn (\n\t\t\trule.short.toLowerCase().indexOf(value) > -1 ||\n\t\t\trule.long.toLowerCase().indexOf(value) > -1\n\t\t);\n\t}\n\n\tSave(id) {\n\t\tconst userId = id.column;\n\t\tlet user = this.app\n\t\t\t.getService(\"local\")\n\t\t\t.users(true)\n\t\t\t.getItem(userId);\n\n\t\tuser.rules = [];\n\t\tthis.$$(\"table\").data.each(row => {\n\t\t\tif (row[userId]) user.rules.push(row.id);\n\t\t});\n\t\tthis.app.getService(\"operations\").updateUser(userId, user);\n\t}\n\n\tToggle(id) {\n\t\tlet item = this.$$(\"table\").getItem(id);\n\t\tconst column = id.column;\n\t\tif (column !== \"short\") {\n\t\t\titem[column] = !item[column];\n\t\t\titem.selected = !item.selected;\n\t\t\tthis.$$(\"table\").updateItem(id, item);\n\t\t\tthis.Save(id);\n\t\t}\n\t}\n\n\tGetUserColumns() {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.users()\n\t\t\t.then(users => {\n\t\t\t\tconst columns = [];\n\t\t\t\tusers.data.each(user => {\n\t\t\t\t\tcolumns.push({\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\ttext: `<span>${user.name}</span>`,\n\t\t\t\t\t\t\tcss: \"webix_um_center_column webix_um_names\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tminWidth: 100,\n\t\t\t\t\t\tfillspace: 1,\n\t\t\t\t\t\tcss: \"webix_um_center_column\",\n\t\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\t\treturn obj[user.id] ? checkedIconAlt : notCheckedIconAlt;\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn columns;\n\t\t\t});\n\t}\n\n\tCreateMatrix(users, rules) {\n\t\tconst data = rules.serialize().map(({ id, short, long }) => {\n\t\t\tlet userAssigned = {};\n\t\t\tusers.data.each(user => {\n\t\t\t\tuserAssigned[user.id] = user.rules\n\t\t\t\t\t? user.rules.indexOf(id) > -1\n\t\t\t\t\t: false;\n\t\t\t});\n\t\t\treturn { id, short, long, ...userAssigned };\n\t\t});\n\t\treturn data;\n\t}\n\n\tToggleColumnSorting(column) {\n\t\tif (column !== \"short\") {\n\t\t\tlet dir =\n\t\t\t\tthis.Sorting.column == column && this.Sorting.dir == \"desc\"\n\t\t\t\t\t? \"asc\"\n\t\t\t\t\t: \"desc\";\n\t\t\tthis.$$(\"table\").sort({ by: column, dir: dir, as: \"string\" });\n\t\t\tthis.$$(\"table\").markSorting(column, dir);\n\t\t\tthis.Sorting.dir = dir;\n\t\t}\n\t\tthis.Sorting.column = column;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { checkedIcon, notCheckedIcon } from \"../../helpers/icons\";\nimport { getRolesList } from \"../../helpers/roleslist\";\n\nexport default class RulesView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.WithRoles = this.app.config.roles;\n\t\tthis.State = \"direct\";\n\n\t\tthis.Options = [\n\t\t\t{ id: \"direct\", value: _(\"Assigned directly\") },\n\t\t\t{ id: \"all\", value: _(\"All assignments\") },\n\t\t];\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\tlocalId: \"title\",\n\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\theight: 30,\n\t\t\t\t\t\t\tcss: \"webix_um_details_title\",\n\t\t\t\t\t\t\ttemplate: \"#name#\",\n\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcols: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\t\t\tlocalId: \"radio\",\n\t\t\t\t\t\t\t\t\tvalue: this.State,\n\t\t\t\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\t\t\t\toptions: this.Options,\n\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\tonChange: o => this.ToggleTable(o),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\thidden: !this.WithRoles,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tview: \"template\",\n\t\t\t\t\t\t\t\t\tlocalId: \"number\",\n\t\t\t\t\t\t\t\t\theight: 38,\n\t\t\t\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\t\t\t\tcss: \"webix_um_details_title_description\",\n\t\t\t\t\t\t\t\t\ttemplate: v => {\n\t\t\t\t\t\t\t\t\t\tconst number = v.rules ? v.rules.length : 0;\n\t\t\t\t\t\t\t\t\t\tlet descr = !number\n\t\t\t\t\t\t\t\t\t\t\t? _(\"No rules\")\n\t\t\t\t\t\t\t\t\t\t\t: `${_(\"Rules assigned\")} (${number})`;\n\t\t\t\t\t\t\t\t\t\treturn `<div class=\"webix_um_details_title_description\">${descr}</div>`;\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdata: { name: \"\" },\n\t\t\t\t\t\t\t\t\thidden: this.WithRoles,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trows: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tview: \"toggle\",\n\t\t\t\t\t\t\t\t\t\t\tlocalId: \"toggle\",\n\t\t\t\t\t\t\t\t\t\t\toffLabel: _(\"Modify\"),\n\t\t\t\t\t\t\t\t\t\t\tonLabel: _(\"Done\"),\n\t\t\t\t\t\t\t\t\t\t\twidth: 160,\n\t\t\t\t\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\t\t\t\t\tonChange: v => this.ToggleVisible(v),\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t{},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst table = {\n\t\t\tview: \"datatable\",\n\t\t\tlocalId: \"rules\",\n\t\t\trowHeight: webix.skin.$active.rowHeight > 30 ? 60 : 52,\n\t\t\trowLineHeight: webix.skin.$active.rowHeight > 30 ? 28 : 26,\n\t\t\tcss: \"webix_um_details_table webix_um_details_table_rules\",\n\t\t\tfixedRowHeight: false,\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"selected\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\theader: \"\",\n\t\t\t\t\twidth: 45,\n\t\t\t\t\tcss: \"webix_um_checkbox_column\",\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn obj.selected ? checkedIcon : notCheckedIcon;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"name\",\n\t\t\t\t\theader: {\n\t\t\t\t\t\tcontentId: \"filter\",\n\t\t\t\t\t\tcontent: \"textFilter\",\n\t\t\t\t\t\tcompare: this.GetCompare(),\n\t\t\t\t\t\tprepare: a => a.toLowerCase(),\n\t\t\t\t\t\tplaceholder: _(\"Search\"),\n\t\t\t\t\t},\n\t\t\t\t\tfillspace: 2,\n\t\t\t\t\tcssFormat: (_, obj) => (obj.selected ? \"webix_um_row_select\" : \"\"),\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\tif (this.State === \"direct\")\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\tobj.short +\n\t\t\t\t\t\t\t\t`<div class='webix_um_details_row'>${obj.long}</div>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\"<div class='webix_um_assignments_description'>\" +\n\t\t\t\t\t\t\t\t`<div><span class=\"webix_um_assignments_rule_name\">${obj.short}</span>: ${obj.long}</div>` +\n\t\t\t\t\t\t\t\tgetRolesList(obj.source) +\n\t\t\t\t\t\t\t\t\"</div>\"\n\t\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.Toggle(id.row * 1),\n\t\t\t\tonResize: function() {\n\t\t\t\t\tthis.adjustRowHeight(\"name\");\n\t\t\t\t},\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_um_roleslist_item: e => {\n\t\t\t\t\tlet id = webix.html.locate(e, \"data-id\");\n\t\t\t\t\tthis.app.callEvent(\"details:item-click\", [\"roles\", id]);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\trows: [form, table],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\t// filters assigned rules for \"direct\"-state table if \"Modify\" toggle is off\n\t\tthis.$$(\"rules\").registerFilter(\n\t\t\tthis.$$(\"toggle\"),\n\t\t\t{\n\t\t\t\tcompare(_v1, _v2, obj) {\n\t\t\t\t\treturn obj.selected;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tgetValue: a => (a.getValue() || this.State !== \"direct\" ? \"\" : true),\n\t\t\t}\n\t\t);\n\t}\n\n\turlChange() {\n\t\tthis.ID = this.getParam(\"id\", true);\n\t\tthis.User = null;\n\t\tthis.ShowAll = false;\n\t\tif (this.State === \"direct\") this.ShowDirectRules();\n\t\telse this.ShowAllAssignments();\n\t}\n\n\t// displays direct or all assigned rules depending on selected state\n\tToggleTable(state) {\n\t\tthis.State = state;\n\t\tthis.$$(\"rules\").clearAll();\n\t\tthis.$$(\"rules\")\n\t\t\t.getHeaderContent(\"filter\")\n\t\t\t.setValue(\"\");\n\t\tif (state === \"direct\") {\n\t\t\tthis.ShowDirectRules();\n\t\t\tthis.$$(\"toggle\").enable();\n\t\t} else {\n\t\t\tif (this.ShowAll) this.$$(\"toggle\").setValue(false);\n\t\t\tthis.ShowAllAssignments();\n\t\t\tthis.$$(\"toggle\").disable();\n\t\t}\n\t}\n\n\tSetUser(userItem, roles) {\n\t\tif (!this.User) {\n\t\t\tthis.User = webix.copy(userItem);\n\t\t\tthis.$$(\"title\").setValues(this.User);\n\t\t\tthis.User.rules = this.User.rules || [];\n\t\t\tthis.User.RulesRoles = this.GetRulesRoles(roles);\n\t\t}\n\t}\n\n\tShowDirectRules() {\n\t\tconst local = this.app.getService(\"local\");\n\t\tPromise.all([local.users(), local.rules(), local.roles()]).then(data => {\n\t\t\tthis.SetUser(data[0].getItem(this.ID), data[2]);\n\t\t\tconst rules = data[1].serialize().map(({ id, short, long }) => ({\n\t\t\t\tid,\n\t\t\t\tshort,\n\t\t\t\tlong,\n\t\t\t\tselected: this.User.rules.indexOf(id) !== -1,\n\t\t\t}));\n\t\t\tthis.$$(\"rules\").parse(rules);\n\t\t\tthis.ShowNumber();\n\t\t\tthis.Filter();\n\t\t});\n\t}\n\n\tShowAllAssignments() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst local = this.app.getService(\"local\");\n\t\tPromise.all([local.users(), local.rules(), local.roles()]).then(data => {\n\t\t\tthis.SetUser(data[0].getItem(this.ID), data[2]);\n\t\t\tconst ruleIds = this.GetAllAssignedRules();\n\t\t\tlet userRules = [];\n\t\t\truleIds.forEach(id => {\n\t\t\t\tconst rule = data[1].getItem(id);\n\t\t\t\tlet source = [];\n\t\t\t\t// get rules assigned directly to a user (if any)\n\t\t\t\tif (this.User.rules.indexOf(id) > -1)\n\t\t\t\t\tsource.push({\n\t\t\t\t\t\tname: _(\"Assigned directly\"),\n\t\t\t\t\t\tdirect: true,\n\t\t\t\t\t});\n\n\t\t\t\t// get rules from assigned roles\n\t\t\t\tif (this.User.RulesRoles[id]) {\n\t\t\t\t\tthis.User.RulesRoles[id].forEach(roleId => {\n\t\t\t\t\t\tconst role = data[2].getItem(roleId);\n\t\t\t\t\t\tsource.push({\n\t\t\t\t\t\t\tid: role.id,\n\t\t\t\t\t\t\tname: role.name,\n\t\t\t\t\t\t\tcolor: role.color,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tuserRules.push({ ...rule, source: source });\n\t\t\t});\n\t\t\tthis.$$(\"rules\").parse(userRules);\n\t\t\tthis.$$(\"rules\").adjustRowHeight(\"name\");\n\t\t});\n\t}\n\n\tSave() {\n\t\tthis.User.rules = [];\n\t\tthis.$$(\"rules\").data.each(\n\t\t\ta => {\n\t\t\t\tif (a.selected) this.User.rules.push(a.id);\n\t\t\t},\n\t\t\tthis,\n\t\t\ttrue\n\t\t);\n\t\tthis.ShowNumber();\n\t\tthis.app.getService(\"operations\").updateUser(this.User.id, this.User);\n\t}\n\n\t// shows radio labels with the number of direct and all assigned rules\n\tShowNumber() {\n\t\tif (this.WithRoles) {\n\t\t\tlet options = this.$$(\"radio\").config.options;\n\t\t\toptions[0].value = `${this.Options[0].value} (${this.User.rules.length})`;\n\t\t\toptions[1].value = `${this.Options[1].value} (${\n\t\t\t\tthis.GetAllAssignedRules().length\n\t\t\t})`;\n\t\t\tthis.$$(\"radio\").refresh();\n\t\t} else this.$$(\"number\").setValues(this.User);\n\t}\n\n\t// returns ids of all assigned rules\n\tGetAllAssignedRules() {\n\t\tlet rules = [...this.User.rules];\n\t\tconst rulesRoles = this.User.RulesRoles;\n\t\tfor (let id in rulesRoles) {\n\t\t\tif (rules.indexOf(id) < 0) rules.push(id * 1);\n\t\t}\n\t\treturn rules;\n\t}\n\n\t// returns object with a rule id as keys\n\t// and an array of asssigned roles ids as values\n\tGetRulesRoles(roles) {\n\t\tlet rules = {};\n\t\t(this.User.roles || []).forEach(id => {\n\t\t\tconst role = roles.getItem(id);\n\t\t\tif (role)\n\t\t\t\t(role.rules || []).forEach(ruleId => {\n\t\t\t\t\tif (rules[ruleId]) rules[ruleId].push(id);\n\t\t\t\t\telse rules[ruleId] = [id];\n\t\t\t\t});\n\t\t});\n\n\t\treturn rules;\n\t}\n\n\t// process \"Modify\" toggle\n\tToggleVisible() {\n\t\tthis.ShowAll = !this.ShowAll;\n\t\tif (this.ShowAll) this.$$(\"rules\").showColumn(\"selected\");\n\t\telse this.$$(\"rules\").hideColumn(\"selected\");\n\t\tthis.Filter();\n\t}\n\n\t// process row click (check) in \"Modify\" mode\n\tToggle(id) {\n\t\tif (!this.ShowAll || this.State !== \"direct\") return;\n\t\tconst item = this.$$(\"rules\").getItem(id);\n\t\tthis.$$(\"rules\").updateItem(id, { selected: !item.selected });\n\t\tthis.Save();\n\t}\n\n\tFilter() {\n\t\tthis.$$(\"rules\").filterByAll();\n\t\tthis.$$(\"rules\").sort((a, b) =>\n\t\t\ta.selected == b.selected\n\t\t\t\t? a.short > b.short\n\t\t\t\t\t? 1\n\t\t\t\t\t: -1\n\t\t\t\t: a.selected\n\t\t\t\t? -1\n\t\t\t\t: 1\n\t\t);\n\t}\n\n\t// shows rows with short and long rule data in filtering results\n\tGetCompare() {\n\t\treturn (value, searchValue, rule) => {\n\t\t\treturn (\n\t\t\t\trule.short.toLowerCase().indexOf(searchValue) > -1 ||\n\t\t\t\trule.long.toLowerCase().indexOf(searchValue) > -1\n\t\t\t);\n\t\t};\n\t}\n}\n","export function getRolesList(roles) {\n\tlet list = \"<ul class='webix_um_roleslist'>\";\n\troles.forEach(role => {\n\t\tif (role.direct)\n\t\t\tlist +=\n\t\t\t\t\"<li class='webix_um_roleslist_item webix_um_roleslist_item_direct'>\";\n\t\telse {\n\t\t\tlist += `<li class='webix_um_roleslist_item' data-id='${role.id}'>`;\n\t\t\tlist += `<span class='webix_um_roleslist_item_marker webix_icon umi-roles' style='color: ${\n\t\t\t\trole.color ? role.color : \"\"\n\t\t\t}'></span>`;\n\t\t}\n\n\t\tlist += role.name + \"</li>\";\n\t});\n\tlist += \"</ul>\";\n\treturn list;\n}\n","import m0 from \"views/_hidden\";\nimport m1 from \"views/addmenu\";\nimport m2 from \"views/compact/sidemenu\";\nimport m3 from \"views/roles/details\";\nimport m4 from \"views/roles/editor\";\nimport m5 from \"views/roles/form\";\nimport m6 from \"views/roles/grid\";\nimport m7 from \"views/roles/index.js\";\nimport m8 from \"views/roles/matrix\";\nimport m9 from \"views/roles/members\";\nimport m10 from \"views/roles/rules\";\nimport m11 from \"views/roles/toolbar\";\nimport m12 from \"views/rules/details\";\nimport m13 from \"views/rules/index.js\";\nimport m14 from \"views/sections/toolbar\";\nimport m15 from \"views/sections/view\";\nimport m16 from \"views/sidebar\";\nimport m17 from \"views/top\";\nimport m18 from \"views/topbar\";\nimport m19 from \"views/users/audit\";\nimport m20 from \"views/users/credentials\";\nimport m21 from \"views/users/details\";\nimport m22 from \"views/users/editor\";\nimport m23 from \"views/users/form\";\nimport m24 from \"views/users/grid\";\nimport m25 from \"views/users/index.js\";\nimport m26 from \"views/users/matrix\";\nimport m27 from \"views/users/roles\";\nimport m28 from \"views/users/rulematrix\";\nimport m29 from \"views/users/rules\";\nimport m30 from \"views/users/toolbar\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"_hidden\"] = m0;\nviews[\"addmenu\"] = m1;\nviews[\"compact/sidemenu\"] = m2;\nviews[\"roles/details\"] = m3;\nviews[\"roles/editor\"] = m4;\nviews[\"roles/form\"] = m5;\nviews[\"roles/grid\"] = m6;\nviews[\"roles\"] = m7;\nviews[\"roles/matrix\"] = m8;\nviews[\"roles/members\"] = m9;\nviews[\"roles/rules\"] = m10;\nviews[\"roles/toolbar\"] = m11;\nviews[\"rules/details\"] = m12;\nviews[\"rules\"] = m13;\nviews[\"sections/toolbar\"] = m14;\nviews[\"sections/view\"] = m15;\nviews[\"sidebar\"] = m16;\nviews[\"top\"] = m17;\nviews[\"topbar\"] = m18;\nviews[\"users/audit\"] = m19;\nviews[\"users/credentials\"] = m20;\nviews[\"users/details\"] = m21;\nviews[\"users/editor\"] = m22;\nviews[\"users/form\"] = m23;\nviews[\"users/grid\"] = m24;\nviews[\"users\"] = m25;\nviews[\"users/matrix\"] = m26;\nviews[\"users/roles\"] = m27;\nviews[\"users/rulematrix\"] = m28;\nviews[\"users/rules\"] = m29;\nviews[\"users/toolbar\"] = m30;\n\nexport default views;\n","export default class Backend {\n\tconstructor(_app, url) {\n\t\tthis._url = url;\n\t}\n\n\tget(path) {\n\t\treturn webix.ajax(this._url + path).then(a => a.json());\n\t}\n\tsave(path, data, mode) {\n\t\tlet x = webix.ajax().headers({ \"Content-type\": \"application/json\" });\n\t\tif (mode == 0) x = x.post(this._url + path, data);\n\t\tif (mode == 1) x = x.del(this._url + path, data);\n\t\tif (mode == 2) x = x.put(this._url + path, data);\n\t\treturn x.then(a => a.json());\n\t}\n\n\tusers() {\n\t\treturn this.get(\"users\");\n\t}\n\taddUser(data) {\n\t\treturn this.save(\"users\", data, 0);\n\t}\n\tdeleteUser(id) {\n\t\treturn this.save(\"users/\" + id, {}, 1);\n\t}\n\tupdateUser(id, data) {\n\t\treturn this.save(\"users/\" + id, data, 2);\n\t}\n\n\troles() {\n\t\treturn this.get(\"roles\");\n\t}\n\taddRole(data) {\n\t\treturn this.save(\"roles\", data, 0);\n\t}\n\tdeleteRole(id) {\n\t\treturn this.save(\"roles/\" + id, {}, 1);\n\t}\n\tupdateRole(id, data) {\n\t\treturn this.save(\"roles/\" + id, data, 2);\n\t}\n\n\trules() {\n\t\treturn this.get(\"rules\");\n\t}\n\tmeta() {\n\t\treturn this.get(\"meta\");\n\t}\n\n\tavatar(id) {\n\t\treturn this._url + `users/${id}/avatar`;\n\t}\n\n\tcredentials(id) {\n\t\treturn this.get(`user/${id}/credentials`);\n\t}\n\taddCredentials(id, data) {\n\t\treturn this.save(`user/${id}/credentials`, data, 0);\n\t}\n\tresetPassword(id, data) {\n\t\treturn this.save(`user/${id}/credentials`, data, 2);\n\t}\n\tdeleteCredentials(id, credId) {\n\t\treturn this.save(`user/${id}/credentials/${credId}`, {}, 1);\n\t}\n\n\tlogs(type, id) {\n\t\treturn this.get(`logs/${type}/${id}`);\n\t}\n\tlogsMeta() {\n\t\treturn this.get(\"logs/meta\");\n\t}\n}\n","export default class Local {\n\tconstructor(_app) {\n\t\tthis._back = _app.getService(\"backend\");\n\t\tthis._data = new Map();\n\t}\n\n\trules(now) {\n\t\treturn getColl(this._data, 1, () => this._back.rules(), now);\n\t}\n\n\tusers(now) {\n\t\t// init meta data loading\n\t\tconst meta = this.meta();\n\t\treturn getColl(this._data, 2, () => this._back.users(), now, c => {\n\t\t\treturn meta.then(links => {\n\t\t\t\tlinks.UserRule.forEach(a => {\n\t\t\t\t\tconst obj = c.getItem(a[0]);\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (!obj.rules) obj.rules = [];\n\t\t\t\t\t\tobj.rules.push(a[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlinks.UserRole.forEach(a => {\n\t\t\t\t\tconst obj = c.getItem(a[0]);\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (!obj.roles) obj.roles = [];\n\t\t\t\t\t\tobj.roles.push(a[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn c;\n\t\t\t});\n\t\t});\n\t}\n\n\troles(now) {\n\t\t// init meta data loading\n\t\tconst meta = this.meta();\n\t\treturn getColl(this._data, 3, () => this._back.roles(), now, c => {\n\t\t\treturn meta.then(links => {\n\t\t\t\tlinks.RoleRule.forEach(a => {\n\t\t\t\t\tconst obj = c.getItem(a[0]);\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tif (!obj.rules) obj.rules = [];\n\t\t\t\t\t\tobj.rules.push(a[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn c;\n\t\t\t});\n\t\t});\n\t}\n\n\tmeta(now) {\n\t\treturn getSome(this._data, 4, () => this._back.meta(), now);\n\t}\n\n\tlogsMeta(now) {\n\t\treturn getSome(this._data, 5, () => this._back.logsMeta(), now);\n\t}\n}\n\nfunction getColl(store, key, handler, now, post) {\n\tif (!store.has(key)) {\n\t\tconst x = {\n\t\t\tpromise: handler().then(data => {\n\t\t\t\tx.obj.parse(data);\n\t\t\t\treturn x.obj;\n\t\t\t}),\n\t\t\tobj: new webix.DataCollection({}),\n\t\t};\n\t\tif (post) x.promise = x.promise.then(post);\n\t\tstore.set(key, x);\n\t}\n\n\tconst x = store.get(key);\n\treturn now ? x.obj : x.promise;\n}\n\nfunction getSome(store, key, handler, now) {\n\tif (!store.has(key)) {\n\t\tconst x = {\n\t\t\tpromise: handler().then(data => (x.obj = data)),\n\t\t\tobj: null,\n\t\t};\n\t\tstore.set(key, x);\n\t}\n\n\tconst x = store.get(key);\n\treturn now ? x.obj : x.promise;\n}\n","export default class Local {\n\tconstructor(_app) {\n\t\tthis._back = _app.getService(\"backend\");\n\t\tthis._local = _app.getService(\"local\");\n\t\tthis._app = _app;\n\t}\n\n\tprogressStart() {\n\t\tthis._app.getService(\"progress\").start();\n\t}\n\tprogressEnd() {\n\t\tthis._app.getService(\"progress\").end();\n\t}\n\n\taddRole(obj) {\n\t\tthis.progressStart();\n\t\treturn Promise.all([this._back.addRole(obj), this._local.roles()]).then(\n\t\t\tdata => {\n\t\t\t\tthis.progressEnd();\n\t\t\t\tobj.id = data[0].id;\n\t\t\t\tdata[1].add(obj);\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t);\n\t}\n\n\taddUser(obj) {\n\t\tthis.progressStart();\n\t\treturn Promise.all([this._back.addUser(obj), this._local.users()]).then(\n\t\t\tdata => {\n\t\t\t\tthis.progressEnd();\n\t\t\t\tobj.id = data[0].id;\n\t\t\t\tdata[1].add(obj);\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t);\n\t}\n\tupdateUser(id, obj) {\n\t\tthis.progressStart();\n\t\treturn Promise.all([\n\t\t\tthis._back.updateUser(id, obj),\n\t\t\tthis._local.users(),\n\t\t]).then(data => {\n\t\t\tthis.progressEnd();\n\t\t\tdata[1].updateItem(id, obj);\n\t\t\treturn obj;\n\t\t});\n\t}\n\tdeleteUser(id) {\n\t\tthis.progressStart();\n\t\treturn Promise.all([this._back.deleteUser(id), this._local.users()]).then(\n\t\t\tdata => {\n\t\t\t\tthis.progressEnd();\n\t\t\t\tdata[1].remove(id);\n\t\t\t\treturn id;\n\t\t\t}\n\t\t);\n\t}\n\n\tupdateRole(id, obj) {\n\t\tthis.progressStart();\n\t\treturn Promise.all([\n\t\t\tthis._back.updateRole(id, obj),\n\t\t\tthis._local.roles(),\n\t\t]).then(data => {\n\t\t\tthis.progressEnd();\n\t\t\tdata[1].updateItem(id, obj);\n\t\t\treturn obj;\n\t\t});\n\t}\n\n\tdeleteRole(id) {\n\t\tthis.progressStart();\n\t\treturn Promise.all([this._back.deleteRole(id), this._local.roles()]).then(\n\t\t\tdata => {\n\t\t\t\tthis.progressEnd();\n\t\t\t\tdata[1].remove(id);\n\t\t\t\treturn id;\n\t\t\t}\n\t\t);\n\t}\n}\n","export default class Progress {\n\tconstructor() {\n\t\tthis.view = null;\n\t}\n\n\thandle(view) {\n\t\tthis.view = view;\n\t}\n\n\tstart() {\n\t\tconst view = this.view;\n\t\tif (!view || view.$destructed) return;\n\t\tview.showBatch(\"saving\");\n\t\tif (this._progressDelay) clearTimeout(this._progressDelay);\n\t\tthis._progressDelay = window.setTimeout(() => {\n\t\t\tif (!view || view.$destructed) return;\n\t\t\tthis.end();\n\t\t}, 3000);\n\t}\n\n\tend() {\n\t\tconst view = this.view;\n\t\tif (!view || view.$destructed) return;\n\t\tview.showBatch(\"saved\");\n\t\tif (this._progressDelay) clearTimeout(this._progressDelay);\n\t\tif (this._hideDelay) clearTimeout(this._hideDelay);\n\t\tthis._hideDelay = window.setTimeout(() => {\n\t\t\tif (!view || view.$destructed) return;\n\t\t\tview.showBatch(\"def\");\n\t\t}, 3000);\n\t}\n}\n","export default class Prompt {\n\tconstructor(app) {\n\t\tthis.view = null;\n\t\tthis.result = null;\n\t\tthis._app = app;\n\t}\n\n\tclose() {\n\t\tthis.view.close();\n\t\tthis.view = null;\n\t}\n\n\tconfig(text) {\n\t\tconst _ = this._app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tmodal: true,\n\t\t\tmove: true,\n\t\t\twidth: 350,\n\t\t\tcss: \"webix_um_prompt\",\n\t\t\thead: {\n\t\t\t\tview: \"toolbar\",\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: webix.skin.$active.layoutPadding.form,\n\t\t\t\t\tright: webix.skin.$active.layoutPadding.form - 5,\n\t\t\t\t},\n\n\t\t\t\tborderless: true,\n\t\t\t\tcols: [\n\t\t\t\t\t{ view: \"label\", label: text },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"icon\",\n\t\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.result.reject(\"prompt cancelled\");\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\tposition: \"center\",\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tpadding: {\n\t\t\t\t\ttop: webix.skin.$active.layoutPadding.form / 2,\n\t\t\t\t\tbottom: webix.skin.$active.layoutPadding.form,\n\t\t\t\t},\n\t\t\t\tcols: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"text\",\n\t\t\t\t\t\tname: \"name\",\n\t\t\t\t\t\tvalue: \"\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\tvalue: _(\"Save\"),\n\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\twidth: 100,\n\t\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tconst form = this.view.getBody();\n\t\t\t\t\t\t\tif (form.validate()) {\n\t\t\t\t\t\t\t\tconst newname = form.getValues().name;\n\t\t\t\t\t\t\t\tthis.result.resolve(newname);\n\t\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\twebix.UIManager.setFocus(form);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonShow() {\n\t\t\t\t\tconst input = this.getBody().elements.name.getInputNode();\n\t\t\t\t\tinput.focus();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tshow(text) {\n\t\tthis.result = new webix.promise.defer();\n\t\tthis.view = webix.ui(this.config(text));\n\t\twebix.delay(() => this.view.show());\n\t\treturn this.result;\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\n// services\nimport Backend from \"./models/Backend\";\nimport Local from \"./models/Local\";\nimport Operations from \"./models/Operations\";\nimport Progress from \"./models/Progress\";\nimport Prompt from \"./models/Prompt\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({});\n\t\tconst params = { state };\n\t\tif (config.compact) params.forceCompact = config.compact;\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/top/users\",\n\t\t\troles: true,\n\t\t\tcompactWidth: 1000,\n\t\t\tparams,\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\tconst dynamic = obj =>\n\t\t\tthis.config.override ? this.config.override.get(obj) || obj : obj;\n\t\tthis.setService(\"backend\", new (dynamic(Backend))(this, this.config.url));\n\t\tthis.setService(\"progress\", new (dynamic(Progress))());\n\t\tthis.setService(\"local\", new (dynamic(Local))(this));\n\t\tthis.setService(\"operations\", new (dynamic(Operations))(this));\n\t\tthis.setService(\"prompt\", new (dynamic(Prompt))(this));\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\t// for external users\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"usermanager\",\n\t\tapp: App,\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\t$init() {\n\t\t\tconst state = this.$app.getState();\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Backend, Local, Operations, Progress, Prompt };\nconst locales = { en };\nexport { views, locales, services };\n","export default {\n\tActive: \"Active\",\n\t\"Add credentials\": \"Add credentials\",\n\t\"Are you sure to delete credentials?\": \"Are you sure to delete credentials?\",\n\t\"Add new user\": \"Add new user\",\n\t\"Are you sure to delete this user?\": \"Are you sure to delete this user?\",\n\tAudit: \"Audit\",\n\tAvatar: \"Avatar\",\n\tCancel: \"Cancel\",\n\t\"changes by\": \"changes by\",\n\t\"changes to\": \"changes to\",\n\tColor: \"Color\",\n\tCredentials: \"Credentials\",\n\tDelete: \"Delete\",\n\tDeleted: \"Deleted\",\n\t\"Delete credentials\": \"Delete credentials\",\n\tDetails: \"Details\",\n\tDone: \"Done\",\n\t\"Enter password\": \"Enter password\",\n\t\"Enter user name\": \"Enter user name\",\n\t\"Error: no email\": \"Error: no email\",\n\t\"Full Name\": \"Full Name\",\n\tGeneral: \"General\",\n\t\"Generate password\": \"Generate password\",\n\tDescription: \"Description\",\n\tEmail: \"Email\",\n\t\"Last visited\": \"Last visited\",\n\tlogins: \"logins\",\n\tMembers: \"Members\",\n\t\"Members assigned\": \"Members assigned\",\n\tModify: \"Modify\",\n\tName: \"Name\",\n\tNew: \"New\",\n\t\"New password\": \"New password\",\n\t\"Not active\": \"Not active\",\n\t\"No members\": \"No members assigned\",\n\t\"No rules\": \"No rules assigned\",\n\tOperation: \"Operation\",\n\t\"Please submit an email first!\": \"Please submit an email first!\",\n\tRegistered: \"Registered\",\n\t\"Reset password\": \"Reset password\",\n\tRules: \"Rules\",\n\t\"Rules assigned\": \"Rules assigned\",\n\t\"Rule Matrix\": \"Rule Matrix\",\n\tSave: \"Save\",\n\tSearch: \"Search\",\n\tStatus: \"Status\",\n\tTarget: \"Target\",\n\tUnknown: \"Unknown\",\n\t\"Unknown user\": \"Unknown user\",\n\t\"Upload new photo\": \"Upload new photo\",\n\t\"User Manager\": \"User Manager\",\n\tUsers: \"Users\",\n\tWhen: \"When\",\n\tWho: \"Who\",\n\n\t// used if Roles feature enabled\n\t\"Add new role\": \"Add new role\",\n\t\"All assignments\": \"All assignments\",\n\t\"Are you sure to delete this role ?\": \"Are you sure to delete this role?\",\n\t\"Assigned directly\": \"Assigned directly\",\n\t\"Enter role name\": \"Enter role name\",\n\t\"No roles\": \"No roles assigned\",\n\tRole: \"Role\",\n\tRoles: \"Roles\",\n\t\"Roles assigned\": \"Roles assigned\",\n\t\"Role Matrix\": \"Role Matrix\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","replace","require","module","__esModule","loadView","over","override","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","key2","nested","reactive","enumerable","configurable","values_1","val","valueOf","HiddenView","hidden","AddNewMenuView","getService","WithRoles","roles","menuItems","width","padding","borderless","css","autoheight","on","onMenuItemClick","AddNew","hide","prompt","addRole","ShowDetails","addUser","collection","SideBarView","newButton","icon","label","click","Menu","Show","$view","splice","rows","paddingX","paddingY","select","ShowPage","height","skin","$active","listItemHeight","AddNewMenu","mode","SideMenu","position","state","left","Parent","SideBar","box","delay","getInfoList","lists","title","record","deleteIcon","addTextMark","EscapedSearchText","rule","short","long","statusBadge","roleAvatar","role","cssClass","color","charAt","toUpperCase","userAvatar","user","avatar","charCodeAt","userCss","UsersView","maxWidth","cols","Edit","ID","TitleTemplate","scroll","onClick","webix_um_infolist_users_name","locate","webix_um_infolist_rules_name","Compact","SetValues","local","waitData","getItem","SetTitle","rules","users","SetDetails","setValues","allRules","allUsers","setHTML","GetDetailsHTML","GetListsHTML","assigned","GetAssignments","GetRoleRules","GetRoleMembers","rIds","roleUsers","each","EditorView","right","bottom","tabMinWidth","barHeight","onChange","v","SetMode","setValue","margin","elementsConfig","labelWidth","labelAlign","Delete","Save","inputWidth","suggest","palette","focus","data_1","roleData","getValues","updateRole","ok","cancel","deleteRole","BaseGrid","rowHeight","headerRowHeight","borderWidth","onAfterSelect","columns","table","$changes","Find","Table","getSelectedId","showItem","EscapeRegExp","toLowerCase","filter","SearchCompare","GridView","header","fillspace","sort","InitSelf","ToolbarView","visibleBatch","batch","ShowSearchHeader","placeholder","HideSearchHeader","State","getValue","showBatch","ToggleVisible","Toolbar","RolesView","HideEditor","checkedIcon","notCheckedIcon","checkedIconAlt","notCheckedIconAlt","MatrixView","Sorting","column","dir","rowLineHeight","leftSplit","onItemClick","Toggle","onHeaderClick","ToggleColumnSorting","GetRoleColumns","GetData","CreateMatrix","roleId","row","item","selected","updateItem","minWidth","serialize","map","_a","roleAssigned","by","as","markSorting","number","offLabel","onLabel","cssFormat","content","checkboxRefresh","ShowAll","registerFilter","_v1","_v2","Role","ShowNumber","Filter","updateUser","showColumn","hideColumn","filterByAll","b","datafilter","umMasterCheckox","master","node","onclick","checked","querySelector","className","columnId","masterCheckbox","RulesView","contentId","GetCompare","prepare","onCustomSave","searchValue","DetailsView","headers","details","info","webix_um_infolist_roles_name","colls","allRoles","uData","rData","GetRoles","GetUsers","configs","RulesGrid","HideDetails","TopBarView","align","handle","sizeTrigger","_compactValue","_compactWidth","_compactHandler","_checkTrigger","$setSize","y","TopView","fCompact","isForced","TopBar","compactWidth","SetCompactMode","ShowSideMenu","coll","ShowList","getBoundingClientRect","dateCommonFormat","dateToStr","dateFromISO","string","AuditView","Type","form","ShowLogTable","InitColumns","Math","max","GetColumns","ShowTarget","logsMeta","date","format","user_id","target_id","GetTarget","ColumnBatches","login","by-user","logs","clearAll","refreshColumns","targetItem","CredentialsWinView","modal","move","head","elements","hotkey","close","GeneratePassword","labelPosition","validate","ResetPassword","onShow","getBody","password","getInputNode","credID","resetPassword","status","userDetails","InfoTemplate","email","FormatDate","visited","rolesData","rulesData","assignedStats","stats","rulesHash","gravity","accept","autowidth","autosend","onAfterFileAdd","fileData","UpdateAvatar","onUploadComplete","UpdateBadge","AddCredentials","DeleteCredentials","ShowCredentials","upload","registered","deleteUser","control","labelRight","file","reader_1","FileReader","onload","SetLocalAvatar","readAsDataURL","credentials","CheckEmail","alert","addCredentials","CredentialsWin","deleteCredentials","round","gridUser","$index","User","GetUserColumns","userId","userAssigned","Options","vertical","o","ToggleTable","fixedRowHeight","direct","onResize","adjustRowHeight","webix_um_roleslist_item","ShowDirectRules","ShowAllAssignments","getHeaderContent","enable","disable","userItem","RulesRoles","GetRulesRoles","SetUser","ruleIds","GetAllAssignedRules","userRules","rulesRoles","ruleId","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","m22","m23","m24","m25","m26","m27","m28","m29","m30","_app","_url","Backend","ajax","json","Content-type","post","del","save","credId","_back","Map","Local","getColl","c","links","UserRule","UserRole","RoleRule","getSome","x_1","x_2","_local","progressStart","progressEnd","add","remove","Progress","$destructed","_progressDelay","clearTimeout","_hideDelay","Prompt","layoutPadding","newname","UIManager","setFocus","defer","compact","forceCompact","defaults","dynamic","Operations","use","App","locales","getState","jetapp","services","Active","Add credentials","Are you sure to delete credentials?","Add new user","Are you sure to delete this user?","Audit","Avatar","Cancel","changes by","changes to","Color","Credentials","Deleted","Delete credentials","Details","Done","Enter password","Enter user name","Error: no email","Full Name","General","Generate password","Description","Email","Last visited","logins","Members","Members assigned","Modify","Name","New","New password","Not active","No members","No rules","Operation","Please submit an email first!","Registered","Reset password","Rules","Rules assigned","Rule Matrix","Search","Status","Target","Unknown","Unknown user","Upload new photo","User Manager","Users","When","Who","Add new role","All assignments","Are you sure to delete this role ?","Assigned directly","Enter role name","No roles","Roles","Roles assigned","Role Matrix"],"mappings":"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"}